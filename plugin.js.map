{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./form/components/relation/vue/relation.html","webpack:///./form/components/relation/vue/relation.js","webpack:///./form/components/relations/vue/relations.html","webpack:///./form/components/relations/vue/relations.js","webpack:///./form/editingform.js","webpack:///./form/editingformservice.js","webpack:///./index.js","webpack:///./panel.js","webpack:///./services/editingservice.js","webpack:///./services/relationservice.js","webpack:///./table/tableservice.js","webpack:///./table/vue/table.html","webpack:///./table/vue/table.js","webpack:///./toolboxes/tool.js","webpack:///./toolboxes/toolbox.js","webpack:///./toolboxes/toolboxesfactory.js","webpack:///./toolboxes/toolsfactory.js","webpack:///./vue/components/tool.html","webpack:///./vue/components/tool.js","webpack:///./vue/components/toolbox.html","webpack:///./vue/components/toolbox.js","webpack:///./vue/components/toolsoftool.html","webpack:///./vue/components/toolsoftool.js","webpack:///./vue/components/toolsoftool/tools.js","webpack:///./vue/editing.html","webpack:///./vue/editing.js","webpack:///./workflows/addfeatureworkflow.js","webpack:///./workflows/addtablefeatureworkflow.js","webpack:///./workflows/commitfeaturesworkflow.js","webpack:///./workflows/deletefeatureworkflow.js","webpack:///./workflows/editfeatureattributesworkflow.js","webpack:///./workflows/editingworkflow.js","webpack:///./workflows/edittablefeatureworkflow.js","webpack:///./workflows/edittableworkflow.js","webpack:///./workflows/linkrelationworkflow.js","webpack:///./workflows/modifygeometryvertexworkflow.js","webpack:///./workflows/movefeatureworkflow.js","webpack:///./workflows/steps/addfeaturestep.js","webpack:///./workflows/steps/addtablefeaturestep.js","webpack:///./workflows/steps/confirmstep.js","webpack:///./workflows/steps/deletefeaturestep.js","webpack:///./workflows/steps/editingstep.js","webpack:///./workflows/steps/linkrelationstep.js","webpack:///./workflows/steps/modifygeometryvertexstep.js","webpack:///./workflows/steps/movefeaturestep.js","webpack:///./workflows/steps/openformstep.js","webpack:///./workflows/steps/opentablestep.js","webpack:///./workflows/steps/pickfeaturestep.js","webpack:///./workflows/steps/tasks/addfeaturetabletask.js","webpack:///./workflows/steps/tasks/addfeaturetask.js","webpack:///./workflows/steps/tasks/confirmtask.js","webpack:///./workflows/steps/tasks/deletefeaturetask.js","webpack:///./workflows/steps/tasks/editingtask.js","webpack:///./workflows/steps/tasks/linkrelationtask.js","webpack:///./workflows/steps/tasks/modifygeometryvertextask.js","webpack:///./workflows/steps/tasks/movefeaturettask.js","webpack:///./workflows/steps/tasks/openformtask.js","webpack:///./workflows/steps/tasks/opentabletask.js","webpack:///./workflows/steps/tasks/pickfeaturetask.js"],"names":["t","g3wsdk","core","i18n","RelationService","require","maxSubsetLength","RelationComponent","Vue","extend","template","props","data","showallfieldsindex","tooltips","add_relation","link_relation","open_relation_tool","unlink_relation","methods","unlinkRelation","index","_service","addRelationAndLink","addRelation","startTool","relationtool","linkRelation","updateExternalKeyValueRelations","input","isRequired","relationAttributesSubset","relation","attributes","fields","relationsFields","forEach","field","_","isArray","value","push","label","end","Math","min","length","slice","relationsAttributesSubsetLength","relationFields","showAllRelationFields","showAllFieds","getRelationTools","computed","relationsLength","relations","fieldrequired","enableAddLinkButtons","type","watch","showRelationStyle","nextTick","$","nanoScroller","created","mounted","formeventbus","$on","$emit","validate","tooltip","destroyed","hideRelationStyle","module","exports","RelationsComponentObj","components","inherit","utils","base","FormComponent","gui","vue","EditingFormService","EditingFormComponent","options","relationsOptions","formEventBus","getService","getEventBus","service","RelationsComponent","buildRelationsComponents","addComponentAfterBody","GUI","EdtingFormService","EditingService","state","_context","context","_inputs","inputs","_formEventBus","formLayer","layer","formFeature","features","isFather","getRelations","getArray","getRelationsInEditing","isNew","self","mixins","_relationsService","resourcesurl","getResourcesUrl","Plugin","plugin","i18nService","Service","EditingPanel","_Plugin","name","init","setService","config","getConfig","loadPlugin","registerPlugin","gid","ready","on","bind","setupGui","isBoolean","visible","toolsComponent","getComponent","toolsService","addTools","action","showEditingPanel","panel","showPanel","load","unload","clear","EditingComponent","EditingPanelComponent","id","title","toolboxes","WorkflowsStack","workflow","PluginService","CatalogLayersStoresRegistry","catalog","MapLayersStoreRegistry","map","LayersStore","Session","editing","Layer","serverErrorParser","errors","parsers","Server","ToolBoxesFactory","CommitFeaturesWorkflow","_sessions","toolboxselected","toolboxidactivetool","message","_mapService","interaction","getActiveTool","stop","_layersstore","queryable","addLayersStore","_editableLayers","_toolboxes","editableLayer","layerId","layers","_getEditableLayersFromCatalog","getId","getLayerForEditing","setLayersColor","addLayers","Object","values","_buildToolBoxes","_createToolBoxDependencies","proto","prototype","RELATIONS_COLOR","LAYERS_COLOR","color","childrenLayers","entries","_layerChildrenRelationInEditing","splice","pop","reverse","getColor","setColor","getChildren","childrenrealtioninediting","undoRelations","undoItems","session","toolbox","toolboxId","items","getToolBoxById","getSession","undo","rollbackRelations","rollbackItems","rollback","redoRelations","redoItems","redo","getEditingLayer","build","addToolBox","getLayer","setFather","dependencies","_getToolBoxEditingDependencies","hasDependencies","isFieldRequired","fieldName","relationLayers","merge","getFathers","toolboxesIds","filter","layerName","_hasEditingDependencies","handleToolboxDependencies","dependecyToolBox","getLayersDependencyFeatures","getDependencies","setEditing","getLayers","EDITABLE","getCurrentWorflow","currentWorkFlow","getLast","getInputs","getContext","feature","getCurrentFeature","getRelationsAttributesByFeature","relationsattributes","getChild","getRelationsByFeature","getType","getFieldsWithValues","layerType","relationChildField","getChildField","relationFatherField","getFatherField","featureValue","isPk","get","editingLayer","getSource","getFeatures","readFeatures","_load","getLayerById","toolBox","getToolBoxes","getEditableLayers","_cancelOrSave","resolve","Promise","reject","commitpromises","getHistory","commit","when","apply","always","refreshMap","setSelected","clearState","removeLayersStore","relationsinediting","relationinediting","getState","valid","stopSessionChildren","relationLayerChildren","inEditing","fatherInEditing","relationLayerFathers","createEditingDataOptions","LayerTypes","VECTOR","bbox","getMapBBOX","children","relationChildLayers","isNil","startLoading","isStarted","start","stopLoading","editor","getEditor","err","console","log","_applyChangesToRelationsAfterCommit","commitItemsRelations","relationsResponse","sessionFeaturesStore","featureStore","relationResponse","getFeaturesStore","clone","setFeatures","applyCommitResponse","response","commitDirtyToolBoxes","isDirty","fail","revert","then","_createCommitMessage","commitItems","create_changes_list_dom_element","add","update","del","changeIds","Aggiunte","join","Modificate","Cancellate","dom","ids","delete","isEmpty","relationName","commits","close","d","Deferred","getCommitItems","result","new_relations","notify","success","force","error","parser","parse","promise","RELATIONTOOLS","default","_relationTools","_isExternalFieldRequired","_layerId","child","_layerType","_add_link_workflow","_checkIfExternalFieldRequired","_currentFeatureFatherFieldValue","fatherField","getCurrentWorkflow","getProperties","relationLayerType","getGeometryType","allrelationtools","icon","getEditingService","getTools","tool","concat","indexOf","cloneDeep","_originalLayerStyle","getStyle","_setAddLinkWorkflow","add_link_workflow","vector","link","table","_getLinkFeatureWorkflow","_getAddFeatureWorkflow","_highlightRelationSelect","geometryType","style","ol","Style","stroke","Stroke","width","image","Circle","radius","fill","Fill","setStyle","startVectorTool","startTableTool","featurestore","relationfeature","getFeatureById","setModal","_createWorkflowOptions","dialog","confirm","pushDelete","removeFeature","EditTableFeatureWorkflow","percContent","_bindEscKeyUp","output","_getRelationFieldsValue","_field","hideContent","_unbindEscKeyUp","_getRelationFeature","workflows","ModifyGeometryVertexWorkflow","MoveFeatureWorkflow","DeleteFeatureWorkflow","EditFeatureAttributesWorkflow","key","classworkflow","getOperator","startFromLastStep","outputs","father","childField","originalRelation","set","pushUpdate","_escKeyUpHandler","evt","keyCode","callback","document","unbind","one","_createRelationObj","_getRelationAsFatherStyleColor","fatherLayerStyle","fatherLayerStyleColor","getFill","getStroke","relationAlreadyLinked","rel","warning","featureId","workflow_options","excludeFields","fatherValue","getImage","opacity","originaRelation","getPk","editable","TableService","_features","_promise","_headers","headers","_fatherValue","_foreignKey","foreignKey","_workflow","isrelation","properties","save","cancel","deleteFeature","editFeature","pk","linkFeature","_setLayout","editing_table_content_height","height","height_70","Component","InternalComponent","$options","showValue","find","header","$nextTick","maxHeightTable","DataTable","columnDefs","orderable","targets","TableComponent","internalComponent","setInternalComponent","unmount","layout","G3WObject","Tool","_session","_layer","_op","op","enabled","active","messages","getMessages","startOp","tools","emit","relationsChanges","setState","setId","getName","setActive","bool","isActive","getIcon","setIcon","setEnabled","isEnabled","setSession","getMessage","operator","getRunningStep","setMessage","clearMessage","OlFeaturesStore","FeaturesStore","ToolBox","_editor","_editingLayer","_loadedExtent","_tools","_getFeaturesOption","toolsstate","featuresstore","historystate","sessionstate","loading","toolmessages","help","toolsoftool","selected","activetool","history","layerstate","onafter","_unregisterGetFeaturesEvent","_registerGetFeaturesEvent","_getFeaturesEvent","event","fnc","extent","_setEditingLayerSource","addRelations","addDependencies","dependency","addDependency","source","Vector","getFeaturesCollection","setSource","getFeaturesOption","is_there_a_father_in_editing","stopActiveTool","_setToolsEnabled","clearToolboxMessages","getMap","un","containsExtent","clearToolMessage","getTitle","setEnable","enableTools","isLoading","isSelected","getToolById","toolId","setActiveTool","clearToolsOfTool","getToolMessage","setToolMessage","restartActiveTool","activeTool","toolmessage","setEditor","hasChildren","hasFathers","hasRelations","EditToolsFactory","EditorToolBoxesFactory","TABLE","Geometry","geometry","AddFeatureWorkflow","EditTableFeaturesWorkflow","AddTableFeatureWorflow","EditorToolsFactory","buildTool","GeometryTypes","POINT","MULTIPOINT","LINESTRING","MULTILINESTRING","LINE","MULTILINE","POLYGON","MULTIPOLYGON","ToolComponent","toggletool","component","ToolsOfToolComponent","ToolboxComponent","showtoolsoftool","select","isLayerReady","toggleEditing","saveEdits","loadToolsOfTools","toolhelpmessage","Tools","snap","EditingTemplate","vueComponentOptions","transitions","saveAll","startToolBox","_getToolBoxById","stopToolBox","saveToolBox","_setActiveToolOfToolbooxSelected","startActiveTool","_checkDirtyToolBoxes","setSelectedToolbox","canCommit","canUndo","isNull","canRedo","PanelComponent","vueComponent","_resourcesUrl","resourcesUrl","mount","parent","EditingWorkflow","AddFeatureStep","OpenFormStep","AddFeatureWorflow","steps","AddTableFeatureStep","ConfirmStep","CommitFeatureWorflow","DeleteFeatureStep","DeleteFeatureWorflow","PickFeatureStep","Workflow","_toolsoftool","setToolsOfTool","getSteps","setSteps","EditTableFeatureWorflow","OpenTableStep","LinkRelationStep","LinkRelationWorflow","ModifyGeometryVertexStep","ModifyGeometryVertexWorflow","pickstep","modifyvertex","MoveFeatureStep","MoveFeatureWorflow","EditingStep","AddFeatureTask","task","Step","AddFeatureTableTask","ConfirmTask","DeleteFeatureTask","LinkRelationTask","ModifyGeometryVertexTask","MoveFeatureTask","OpenFormTask","OpenTableTask","PickFeatureTask","EditingTask","run","originalLayer","createNewFeature","pushAdd","addFeature","Feature","_busy","drawInteraction","_snap","_snapInteraction","_finishCondition","finishCondition","constant","_condition","condition","getEditingGeometryType","getFields","temporarySource","Draw","addInteraction","e","attribute","isPkEditable","setNew","setTemporaryId","Snap","removeInteraction","_removeLastPoint","removeLastPoint","Dialogs","buttons","SAVE","className","CANCEL","_dialog","DeleteInteraction","ol3","interactions","DeleteFeatureInteraction","_selectInteraction","geom","GeometryType","LINE_STRING","LINEAR_RING","MULTI_POINT","MULTI_LINE_STRING","MULTI_POLYGON","GEOMETRY_COLLECTION","CIRCLE","white","red","styles","zIndex","Infinity","originaLayer","Select","events","click","getGeometry","_deleteInteraction","relationsInEditing","updateRelation","relationService","required","remove","Task","PickFeatureInteraction","pickFeatureInteraction","_originalStyle","_feature","_deleteCondition","deleteCondition","undefined","originalFeature","newFeature","coordinates","getCoordinates","MultiPoint","Collection","_modifyInteraction","Modify","getExtent","removePoint","coordinate","_isNew","originalStyle","_translateInteraction","Translate","hitTolerance","isMobile","any","_formIdPrefix","_isContentChild","_originalLayer","_layerName","_originalFeature","_pk","_fields","_getFieldUniqueValuesFromServer","uniqueFields","fieldsName","getWidgetData","_getUniqueFieldsType","_getForm","getLength","exclude","showContentFactory","_cancelFnc","_saveFnc","setFieldsWithValues","startForm","formComponent","Form","formService","_generateFormId","dataid","isnew","modal","showgoback","class","cbk","popContent","closeForm","getEditingFields","content","showContent","closable"],"mappings":"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","file":"plugin.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","module.exports = \"<div style=\\\"border:2px solid rgba(60,141,188,.1);margin-bottom:5px;border-radius:3px\\\"> <div class=\\\"box-header with-border\\\" style=margin-button:3px;background-color:#fff> <div class=container style=width:100%> <div class=row> <div class=\\\"col-lg-10 col-sm-12\\\"> <h5 style=font-weight:700>{{ relation.name }}</h5> </div> <div class=\\\"col-lg-1 col-sm-6 add-link\\\" data-toggle=tooltip data-placement=bottom :title=tooltips.add_relation @click=\\\"enableAddLinkButtons ? addRelationAndLink() : null\\\"> <span class=\\\"g3w-icon g3w-plus\\\" style=font-size:20px;color:#3c8dbc :class=\\\"{'disabled' : !enableAddLinkButtons }\\\"></span> </div> <div class=\\\"col-md-1 col-sm-6 add-link\\\" data-toggle=tooltip data-placement=bottom :title=tooltips.link_relation @click=\\\"enableAddLinkButtons ? linkRelation() : null\\\"> <span class=\\\"g3w-icon g3w-link\\\" style=font-size:20px;color:#3c8dbc :class=\\\"{'disabled': !enableAddLinkButtons}\\\"></span> </div> </div> </div> </div> <div class=box-body style=padding:0> <template v-if=relationsLength> <table class=\\\"table table-striped\\\"> <thead> <tr> <th v-for=\\\"attribute in relationAttributesSubset(relations[0])\\\"> {{attribute.label}} </th> <th></th> <th></th> <th></th> </tr> </thead> <tbody> <tr v-for=\\\"(relation, index) in relations\\\" class=featurebox-header> <td v-show=!showAllFieds(index) v-for=\\\"attribute in relationAttributesSubset(relation)\\\"> <span>{{attribute.value}}</span> </td> <td v-show=showAllFieds(index) :colspan=relationsAttributesSubsetLength(relation)> <table style=\\\"background:0 0!important\\\"> <tr v-for=\\\"field in relationsFields(relation)\\\"> <td class=attr-label>{{field.label}}</td> <td class=attr-value> <span>{{field.value}}</span> </td> </tr> </table> </td> <td class=action-cell> <span @click=showAllRelationFields(index) style=color:#3c8dbc;cursor:pointer class=\\\"fa link morelink\\\" :class=\\\"[showallfieldsindex == index ? 'fa-minus': 'fa-ellipsis-h' ]\\\"> </span> </td> <td> <span v-if=!fieldrequired class=\\\"g3w-mini-relation-icon g3w-icon g3w-unlink pull-right\\\" @click=unlinkRelation(index) data-toggle=tooltip data-placement=bottom :title=tooltips.unlink_relation aria-hidden=true> </span> </td> <td> <div class=dropup> <span data-toggle=dropdown data-placement=bottom :title=tooltips.open_relation_tool aria-haspopup=true aria-expanded=false class=\\\"dropdown-toggle g3w-icon g3w-mini-relation-icon g3w-cogs pull-right g3w-relation-tools\\\" aria-hidden=true> </span> <div class=\\\"dropdown-menu pull-right\\\" style=\\\"margin-bottom:5px;box-shadow:3px 3px 3px rgba(0,0,0,.5)!important\\\" :style=\\\"{'min-width': getRelationTools().length*40 + 'px !important' }\\\"> <div @click=\\\"startTool(relationtool, index)\\\" v-for=\\\"relationtool in getRelationTools()\\\" data-toggle=tooltip data-placement=bottom :title=relationtool.state.name class=\\\"editbtn enabled\\\" style=display:inline-block> <img height=20px width=20px :src=\\\"resourcesurl + 'images/'+ relationtool.state.icon\\\"/> </div> </div> </div> </td> </tr> </tbody> </table> </template> </div> </div> \";","const t = g3wsdk.core.i18n.t;\nconst RelationService = require('../../../../services/relationservice');\nconst maxSubsetLength = 3;\n\n RelationComponent = Vue.extend({\n  template: require('./relation.html'),\n  props: ['relation', 'relations', 'resourcesurl', 'formeventbus'],\n  data: function() {\n    return {\n      showallfieldsindex: null,\n      tooltips: {\n        add_relation: t(\"form.relations.tooltips.add_relation\"),\n        link_relation: t(\"form.relations.tooltips.link_relation\"),\n        open_relation_tool: t(\"form.relations.tooltips.open_relation_tools\"),\n        unlink_relation: t(\"form.relations.tooltips.unlink_relation\")\n      }\n    }\n  },\n  methods: {\n    unlinkRelation: function(index) {\n      this._service.unlinkRelation(index)\n    },\n    addRelationAndLink: function() {\n      this._service.addRelation();\n    },\n    startTool: function(relationtool, index) {\n      this._service.startTool(relationtool, index)\n    },\n    linkRelation: function() {\n      this._service.linkRelation();\n    },\n    updateExternalKeyValueRelations: function(input) {\n      this._service.updateExternalKeyValueRelations(input);\n    },\n    isRequired: function() {\n      return this._service.isRequired();\n    },\n    relationAttributesSubset: function(relation) {\n      let attributes = [];\n      const fields = this.relationsFields(relation);\n      fields.forEach((field) => {\n        if (_.isArray(field.value)) return;\n        attributes.push({label: field.label, value: field.value})\n      });\n      const end = Math.min(maxSubsetLength, attributes.length);\n      return attributes.slice(0, end);\n    },\n    relationsAttributesSubsetLength: function(relation) {\n      return this.relationAttributesSubset(relation).length;\n    },\n    relationsFields: function(relation) {\n      let attributes = this._service.relationFields(relation);\n      return attributes;\n    },\n    showAllRelationFields: function(index) {\n      this.showallfieldsindex = this.showallfieldsindex == index ? null : index;\n    },\n    showAllFieds: function(index) {\n      return this.showallfieldsindex == index;\n    },\n    getRelationTools: function() {\n      return this._service.getRelationTools();\n    }\n  },\n  computed: {\n    relationsLength: function() {\n      return this.relations.length;\n    },\n    fieldrequired: function() {\n      return this._service.isRequired();\n    },\n    enableAddLinkButtons: function() {\n      return !this.relations.length || (this.relations.length && this.relation.type != 'ONE');\n    }\n  },\n  watch: {\n    // vado a verificare lo state\n    'relations': function() {\n      this._service.showRelationStyle();\n      Vue.nextTick(function() {\n        // con l'aggiunta di relazioni vado a fare il nano scroll\n        $(\".g3w-form-component_relations .nano\").nanoScroller();\n      })\n    }\n  },\n  created: function() {\n    //vado a settare il servizio\n    this._service = new RelationService({\n      relation: this.relation,\n      relations: this.relations\n    })\n  },\n  mounted: function() {\n    this._service.showRelationStyle();\n    this.formeventbus.$on('changeinput', this.updateExternalKeyValueRelations);\n    this.formeventbus.$emit('addtovalidate', this.validate);\n    Vue.nextTick(function() {\n      $('.g3w-form-component_relations [data-toggle=\"tooltip\"], .g3w-relation-tools').tooltip();\n    })\n\n  },\n  destroyed: function() {\n    this._service.hideRelationStyle();\n  }\n });\n\nmodule.exports = RelationComponent;\n","module.exports = \"<div class=nano v-if=relations.length> <div class=nano-content> <div class=g3w-form-component_relations> <div class=nano> <div class=nano-content> <relation :relation=relation.relation :relations=relation.relations :resourcesurl=resourcesurl :formeventbus=formeventbus v-for=\\\"relation in relations\\\" :key=relation.id> </relation> </div> </div> </div> </div> </div>\";","const RelationComponent = require('../../relation/vue/relation');\nconst RelationsComponentObj = {\n  template: require('./relations.html'),\n  components: {\n    'relation': RelationComponent\n  }\n};\n\nmodule.exports = RelationsComponentObj;\n","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst FormComponent = g3wsdk.gui.vue.FormComponent;\nconst EditingFormService = require('./editingformservice');\n\nfunction EditingFormComponent(options) {\n  options = options || {};\n  base(this, options);\n  // solo tutte le informazini relative alle relazioni di quella toolbox/layer\n  const relationsOptions = options.relationsOptions;\n  // recuprare l'event bus del form\n  relationsOptions.formEventBus = this.getService().getEventBus();\n  // vado a creare il servizio delle relazioni\n  const service = new EditingFormService(relationsOptions);\n  // mi restituisce il componente Vue da passare al form\n  const RelationsComponent = service.buildRelationsComponents();\n  // qui vado ad aggiungere il componente relations\n  this.addComponentAfterBody(RelationsComponent);\n}\n\ninherit(EditingFormComponent, FormComponent);\n\nmodule.exports = EditingFormComponent;\n","const GUI = g3wsdk.gui.GUI;\nconst RelationsComponentObj = require('./components/relations/vue/relations');\nconst EdtingFormService = function(options) {\n  const EditingService = require('../services/editingservice');\n  options = options || {};\n  this.state = {\n    relations: []\n  };\n  // riceve il context del form principale\n  this._context = options.context || {};\n  // riceve gli inpust del form principale\n  this._inputs = options.inputs || {};\n  // riceve l'event bus del form pricipale\n  this._formEventBus = options.formEventBus || null;\n  // sono le relazioni effettive presenti\n  let relations = [];\n  const formLayer = this._context.layer;\n  const formFeature = this._inputs.features[this._inputs.features.length - 1];\n  if (formLayer.isFather()) {\n    // recupero l'array delle relazioni\n    relations = formLayer.getRelations().getArray();\n    // vado a filtrare le relazioni per quelle che son o effettivamente in editing\n    relations = EditingService.getRelationsInEditing(relations, formFeature, formFeature.isNew());\n    // le relazioni in questione sono oggetti Realtion che contengono le informazioni nello stato delle composizione della relazione\n  }\n\n  // funzione che mi serve per costruire il componente vue da innestare dentro il form\n  // come componente relations\n  this.buildRelationsComponents = function() {\n    const self = this;\n    return Vue.extend({\n      mixins: [RelationsComponentObj],\n      methods: {\n        getService: function() {\n          return self._relationsService;\n        }\n      },\n      data: function() {\n        return {\n          relations: relations,\n          resourcesurl: GUI.getResourcesUrl(),\n          formeventbus: self._formEventBus\n        }\n      }\n    })\n  };\n};\n\nmodule.exports =  EdtingFormService;\n","const inherit = g3wsdk.core.utils.inherit;\nconst base = g3wsdk.core.utils.base;\nconst Plugin = g3wsdk.core.plugin.Plugin;\nconst GUI = g3wsdk.gui.GUI;\nconst i18nService = g3wsdk.core.i18n;\nconst Service = require('./services/editingservice');\nconst EditingPanel = require('./panel');\n\nconst _Plugin = function() {\n  base(this);\n  this.name = 'editing';\n  this.init = function() {\n    this.setService(Service);\n    this.config = this.getConfig();\n    // check if exist any layer to edit\n    if (this.service.loadPlugin()) {\n      //inizialize service\n     this.service.init(this.config);\n      //plugin registry\n      if (this.registerPlugin(this.config.gid)) {\n        if (!GUI.ready) {\n          GUI.on('ready',_.bind(this.setupGui, this));\n        } else {\n          this.setupGui();\n        }\n      }\n    }\n  };\n  //setup plugin interface\n  this.setupGui = function() {\n    if (_.isBoolean(this.config.visible) && !this.config.visible)\n      return false;\n    let self = this;\n    let toolsComponent = GUI.getComponent('tools');\n    let toolsService = toolsComponent.getService();\n    toolsService.addTools(0, 'EDITING', [\n      {\n        name: i18nService.t(\"editing_data\"),\n        action: _.bind(self.showEditingPanel, this)\n      }\n    ])\n  };\n\n  //method to show editing panel\n  this.showEditingPanel = function() {\n    const panel = new EditingPanel();\n    GUI.showPanel(panel);\n  };\n\n  this.load = function() {\n    this.init();\n  };\n\n  this.unload = function() {\n    this.service.clear()\n  }\n};\n\ninherit(_Plugin, Plugin);\n\n(function(plugin){\n  plugin.init();\n})(new _Plugin);\n\n","var base = g3wsdk.core.utils.base;\nvar inherit = g3wsdk.core.utils.inherit;\nvar i18nService = g3wsdk.core.i18n;\nvar EditingComponent = require('./vue/editing');\n\nfunction EditingPanelComponent(options) {\n  options = options || {};\n  // editortoolsbars\n  options.id = \"editing-panel\";\n  options.title = i18nService.t(\"editing_data\");\n  options.name = \"Gestione dati EDITING\";\n  options.toolboxes = options.toolboxes || null;\n  base(this, options)\n}\n\ninherit(EditingPanelComponent, EditingComponent);\n\nmodule.exports = EditingPanelComponent;\n\n\n","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst WorkflowsStack = g3wsdk.core.workflow.WorkflowsStack;\nconst PluginService = g3wsdk.core.plugin.PluginService;\nconst CatalogLayersStoresRegistry = g3wsdk.core.catalog.CatalogLayersStoresRegistry;\nconst MapLayersStoreRegistry = g3wsdk.core.map.MapLayersStoreRegistry;\nconst LayersStore = g3wsdk.core.layer.LayersStore;\nconst Session = g3wsdk.core.editing.Session;\nconst Layer = g3wsdk.core.layer.Layer;\nconst GUI = g3wsdk.gui.GUI;\nconst serverErrorParser= g3wsdk.core.errors.parsers.Server;\nconst ToolBoxesFactory = require('../toolboxes/toolboxesfactory');\nconst t = g3wsdk.core.i18n.t;\nconst CommitFeaturesWorkflow = require('../workflows/commitfeaturesworkflow');\n\nfunction EditingService() {\n  base(this);\n  // contains alla sessions\n  this._sessions = {};\n  // state of editing\n  this.state = {\n    toolboxes: [], // contiene tutti gli stati delle toolbox in editing\n    toolboxselected: null, // tiene riferimento alla toolbox selezionata\n    toolboxidactivetool: null,\n    message: null, // messaggio genarle del pannello di editing\n    relations: [] // relazioni\n  };\n  //mapservice\n  this._mapService = GUI.getComponent('map').getService();\n  // disable active tool on wehena a control is activated\n  this._mapService.on('mapcontrol:active', (interaction) => {\n    let toolboxselected = this.state.toolboxselected;\n    if ( toolboxselected && toolboxselected.getActiveTool()) {\n      toolboxselected.getActiveTool().stop();\n    }\n  });\n  // prendo tutti i layers del progetto corrente che si trovano\n  // all'interno dei Layerstore del catalog registry con caratteristica editabili.\n  // Mi verranno estratti tutti i layer editabili anche quelli presenti nell'albero del catalogo\n  // come per esempio il caso di layers relazionati\n  this.init = function(config) {// layersStore del plugin editing che conterr tutti i layer di editing\n    this._layersstore = new LayersStore({\n      id: 'editing',\n      queryable: false // lo setto a false cos che quando faccio la query (controllo) non prendo anche questi\n    });\n    //add edting layer store to mapstoreregistry\n    MapLayersStoreRegistry.addLayersStore(this._layersstore);\n    // setto la configurazione del plugin\n    this.config = config;\n    // oggetto contenente tutti i layers in editing\n    this._editableLayers = {};\n    // contiene tutti i toolbox\n    this._toolboxes = [];\n    // restto\n    this.state.toolboxes = [];\n    let editableLayer;\n    let layerId;\n    // sono i layer originali caricati dal progetto e messi nel catalogo\n    let layers = this._getEditableLayersFromCatalog();\n    //ciclo su ogni layers editiabile\n    layers.forEach((layer) => {\n      layerId = layer.getId();\n      // vado a chiamare la funzione che mi permette di\n      // estrarre la versione editabile del layer di partenza (es. da imagelayer a vector layer, table layer/tablelayer etc..)\n      editableLayer = layer.getLayerForEditing();\n      // se di tipo table assesgno sempre un solo colore\n      //color = layer.getType() == Layer.LayerTypes.TABLE ? \"#cc3300\" : COLORS.splice(0,1).pop();\n      // setto il colore che mi servr per colorarare si il vettoriale che il toolbox\n      //editableLayer.setColor(color);\n      // vado ad aggiungere ai layer editabili\n      this._editableLayers[layerId] = editableLayer;\n      // aggiungo all'array dei vectorlayers se per caso mi servisse\n      this._sessions[layerId] = null;\n    });\n    // set toolbox colors\n    this.setLayersColor();\n    // after sadd layers to layerstore\n    this._layersstore.addLayers(Object.values(this._editableLayers));\n    // vado a creare i toolboxes\n    this._buildToolBoxes();\n    // create a dependencies tree\n    this._createToolBoxDependencies();\n  }\n}\n\ninherit(EditingService, PluginService);\n\nlet proto = EditingService.prototype;\n\nproto.setLayersColor = function() {\n\n  const RELATIONS_COLOR = [\n    [\"#656F94\",\n      \"#485584\",\n      \"#303E73\",\n      \"#1B2B63\",\n      \"#0C1B53\"],\n\n    [\"#CF858F\",\n      \"#B95A67\",\n      \"#A23645\",\n      \"#8B1929\",\n      \"#740313\"],\n\n    [\"#86B976\",\n      \"#64A450\",\n      \"#479030\",\n      \"#2F7C16\",\n      \"#1B6803\"],\n\n    [\"#DAC28C\",\n      \"#C2A45E\",\n      \"#AA8739\",\n      \"#926E1A\",\n      \"#7A5603\"]\n  ];\n\n  const LAYERS_COLOR = [\n    \"#AFEE30\",\n    \"#96C735\",\n    \"#7B9F35\",\n    \"#5F772F\",\n    \"#414F25\",\n\n    \"#4138B2\",\n    \"#3E3794\",\n    \"#373276\",\n    \"#2E2B59\",\n    \"#22203B\",\n\n    \"#FFD033\",\n    \"#D5B139\",\n    \"#AA9039\",\n    \"#7F6E33\",\n    \"#544A27\",\n\n    \"#CD2986\",\n    \"#AB2E74\",\n    \"#882D61\",\n    \"#66294B\",\n    \"#431F34\"\n  ];\n  let color;\n  let childrenLayers;\n  Object.entries(this._editableLayers).forEach(([layerId, layer]) => {\n    // verifico se  un layer  padre e se ha figli in editing\n    childrenLayers = this._layerChildrenRelationInEditing(layer);\n    if (layer.isFather() && childrenLayers.length) {\n      color = RELATIONS_COLOR.splice(0,1).pop().reverse();\n      !layer.getColor() ? layer.setColor(color.splice(0,1).pop()): null;\n      childrenLayers.forEach((layerId) => {\n        !this._editableLayers[layerId].getColor() ? this._editableLayers[layerId].setColor(color.splice(0,1).pop()): null;\n      });\n    }\n  });\n  Object.entries(this._editableLayers).forEach(([layerId, layer]) => {\n    !this._editableLayers[layerId].getColor() ? layer.setColor(LAYERS_COLOR.splice(0,1).pop()): null;\n  })\n};\n\nproto._layerChildrenRelationInEditing = function(layer) {\n  let relations = layer.getChildren();\n  let childrenrealtioninediting = [];\n  relations.forEach((relation) => {\n    if (this._editableLayers[relation])\n      childrenrealtioninediting.push(relation);\n  });\n  return childrenrealtioninediting;\n};\n\n// udo delle relazioni\nproto.undoRelations = function(undoItems) {\n  let session;\n  let toolbox;\n  Object.entries(undoItems).forEach(([toolboxId, items]) => {\n    toolbox = this.getToolBoxById(toolboxId);\n    session = toolbox.getSession();\n    session.undo(items);\n  })\n};\n\n// undo delle relazioni\nproto.rollbackRelations = function(rollbackItems) {\n  let session;\n  let toolbox;\n  Object.entries(rollbackItems).forEach(([toolboxId, items]) => {\n    toolbox = this.getToolBoxById(toolboxId);\n    session = toolbox.getSession();\n    session.rollback(items);\n  })\n};\n\n// redo delle relazioni\nproto.redoRelations = function(redoItems) {\n  let session;\n  let toolbox;\n  Object.entries(redoItems).forEach(([toolboxId, items]) => {\n    toolbox = this.getToolBoxById(toolboxId);\n    session = toolbox.getSession();\n    session.redo(items);\n  })\n};\n\n// restituisce il layer che viene utilizzato dai task per fare le modifiche\n// ol.vector nel cso dei vettoriali, tableLayer nel caso delle tabelle\nproto.getEditingLayer = function(id) {\n  let toolbox = this.getToolBoxById(id);\n  return toolbox.getEditingLayer();\n};\n\nproto._buildToolBoxes = function() {\n  let toolbox;\n  _.forEach(this._editableLayers, (layer) => {\n    // la toolboxes costruir il toolboxex adatto per quel layer\n    // assegnadogli le icone dei bottonii etc ..\n    toolbox = ToolBoxesFactory.build(layer);\n    // vado ad aggiungere la toolbox\n    this.addToolBox(toolbox);\n  })\n};\n\n//funzione che server per aggiungere un editor\nproto.addToolBox = function(toolbox) {\n  this._toolboxes.push(toolbox);\n  // vado ad aggiungere la sessione\n  this._sessions[toolbox.getId()] = toolbox.getSession();\n  this.state.toolboxes.push(toolbox.state);\n};\n\n// funzione che crea le dipendenze\nproto._createToolBoxDependencies = function() {\n  let layer;\n  this._toolboxes.forEach((toolbox) => {\n    layer = toolbox.getLayer();\n    toolbox.setFather(layer.isFather());\n    toolbox.state.editing.dependencies = this._getToolBoxEditingDependencies(layer);\n    if (layer.isFather() && toolbox.hasDependencies() ) {\n      _.forEach(layer.getRelations().getRelations(), (relation) => {\n        toolbox.addRelation(relation);\n      })\n    }\n  })\n};\n\nproto.isFieldRequired = function(layerId, fieldName) {\n  return this._editableLayers[layerId].isFieldRequired(fieldName);\n};\n\nproto._getToolBoxEditingDependencies = function(layer) {\n  let relationLayers = _.merge(layer.getChildren(), layer.getFathers());\n  let toolboxesIds = relationLayers.filter((layerName) => {\n    return !!this._editableLayers[layerName]\n  });\n  return toolboxesIds;\n};\n\n// verifico se le sue diendenza sono legate a layer effettivamente in editing o no\nproto._hasEditingDependencies = function(layer) {\n  let toolboxesIds = this._getToolBoxEditingDependencies(layer);\n  return !!toolboxesIds.length;\n};\n\n// funzione che serve a manageggia\nproto.handleToolboxDependencies = function(toolbox) {\n  let dependecyToolBox;\n  if (toolbox.isFather())\n  // verifico se le feature delle dipendenze sono state caricate\n    this.getLayersDependencyFeatures(toolbox.getId());\n  toolbox.getDependencies().forEach((toolboxId) => {\n    dependecyToolBox = this.getToolBoxById(toolboxId);\n    // disabilito visivamente l'editing\n    dependecyToolBox.setEditing(false);\n  })\n};\n\nproto._getEditableLayersFromCatalog = function() {\n  let layers = CatalogLayersStoresRegistry.getLayers({\n    EDITABLE: true\n  });\n  return layers;\n};\n\nproto.getCurrentWorflow = function() {\n  let currentWorkFlow = WorkflowsStack.getLast();\n  return {\n    session: currentWorkFlow.getSession(),\n    inputs: currentWorkFlow.getInputs(),\n    context: currentWorkFlow.getContext(),\n    feature: currentWorkFlow.getCurrentFeature(),\n    layer: currentWorkFlow.getLayer()\n  };\n};\n\nproto.getRelationsAttributesByFeature = function(relation, feature) {\n  let relationsattributes = [];\n  let toolboxId = relation.getChild();\n  let layer = this.getToolBoxById(toolboxId).getLayer();\n  let relations = this.getRelationsByFeature(relation, feature, layer.getType());\n  let fields;\n  relations.forEach((relation) => {\n    fields = layer.getFieldsWithValues(relation);\n    relationsattributes.push({\n      fields: fields,\n      id: relation.getId()\n    });\n  });\n  return relationsattributes;\n};\n\nproto.getRelationsByFeature = function(relation, feature, layerType) {\n  let toolboxId = relation.getChild();\n  let relationChildField = relation.getChildField();\n  let relationFatherField= relation.getFatherField();\n  let featureValue = feature.isPk(relationFatherField) ? feature.getId() : feature.get(relationFatherField);\n  let toolbox = this.getToolBoxById(toolboxId);\n  let editingLayer = toolbox.getEditingLayer();\n  let features = layerType == 'vector' ? editingLayer.getSource().getFeatures() : editingLayer.getSource().readFeatures() ;\n  let relations = [];\n  features.forEach((feature) => {\n    if (feature.get(relationChildField) == featureValue) {\n      relations.push(feature);\n    }\n  });\n  return relations;\n};\n\nproto.loadPlugin = function() {\n  return this._load = !!this._getEditableLayersFromCatalog().length; // mi dice se ci sono layer in editing e quindi da caricare il plugin\n};\n\n// ritorna i layer editabili presenti nel layerstore dell'editing\nproto.getLayers = function() {\n  return this._editableLayers;\n};\n\n// funzione che restituisce l'editing layer estratto dal layer del catalogo\n// vectorLayer lel caso di un imageLayere e tablelayer  nel cso di un table lauer\nproto.getLayerById = function(layerId) {\n  return this._editableLayers[layerId];\n};\n\n// vado a recuperare il toolbox a seconda del suo id\nproto.getToolBoxById = function(toolboxId) {\n  let toolBox = null;\n  this._toolboxes.forEach((toolbox) => {\n    if (toolbox.getId() == toolboxId) {\n      toolBox = toolbox;\n      return false;\n    }\n  });\n  return toolBox;\n};\n\nproto.getToolBoxes = function() {\n  return this._toolboxes;\n};\n\nproto.getEditableLayers = function() {\n  return this._editableLayers;\n};\n\nproto._cancelOrSave = function(){\n  return resolve();\n};\n\nproto.stop = function() {\n  return new Promise((resolve, reject) => {\n    let commitpromises = [];\n    // vado a chiamare lo stop di ogni toolbox\n    this._toolboxes.forEach((toolbox) => {\n      // vado a verificare se c' una sessione sporca e quindi\n      // chiedere se salvare\n      if (toolbox.getSession().getHistory().state.commit) {\n        // ask to commit before exit, sdet true to close\n        commitpromises.push(this.commit(toolbox, true));\n      }\n    });\n    // prima di stoppare tutto e chidere panello\n    $.when.apply(this, commitpromises)\n      .always(() => {\n        this._mapService.refreshMap();\n        this._toolboxes.forEach((toolbox) => {\n          // vado a stoppare tutti le toolbox\n          toolbox.stop();\n          // vado a deselzionare eventuali toolbox\n          toolbox.setSelected(false);\n        });\n        this.clearState();\n        resolve();\n    });\n  });\n};\n\n// remove Editing LayersStore\nproto.clear = function() {\n  MapLayersStoreRegistry.removeLayersStore(this._layersstore);\n};\n\nproto.clearState = function() {\n  this.state.toolboxselected = null; // tiene riferimento alla toolbox selezionata\n  this.state.toolboxidactivetool =  null;\n  this.state.message =  null; // messaggio genarle del pannello di editing\n};\n\n// funzione che filtra le relazioni in base a quelle presenti in editing\nproto.getRelationsInEditing = function(relations, feature, isNew) {\n  let relationsinediting = [];\n  let relationinediting;\n  relations.forEach((relation) => {\n    if (this._editableLayers[relation.getChild()]) {\n      // aggiungo lo state della relazione\n      relationinediting = {\n        relation:relation.getState(),\n        relations: !isNew ? this.getRelationsAttributesByFeature(relation, feature): [] // le relazioni esistenti\n      };\n      relationinediting.validate = {\n        valid:true\n      };\n      relationsinediting.push(relationinediting);\n    }\n  });\n  return relationsinediting;\n};\n\n// qui devo verificare sia l condizione del padre che del figlio\nproto.stopSessionChildren = function(layerId) {\n  // caso padre verifico se i figli sono in editing o meno\n  let relationLayerChildren = this._editableLayers[layerId].getChildren();\n  let toolbox;\n  relationLayerChildren.forEach((id) => {\n    toolbox = this.getToolBoxById(id);\n    if (toolbox && !toolbox.inEditing())\n      this._sessions[id].stop();\n  });\n};\n\nproto.fatherInEditing = function(layerId) {\n  let inEditing = false;\n  let toolbox;\n  // caso padre verifico se ci sono padri in editing o meno\n  let relationLayerFathers = this._editableLayers[layerId].getFathers();\n  relationLayerFathers.forEach((id) => {\n    toolbox = this.getToolBoxById(id);\n    if (toolbox && toolbox.inEditing()) {\n      inEditing = true;\n      return false;\n    }\n  });\n  return inEditing;\n};\n\n// prendo come opzione il tipo di layer\nproto.createEditingDataOptions = function(layerType) {\n  let options = {\n    editing: true,\n    type: layerType\n  };\n  // verifico se layer vettoriale\n  if(layerType == Layer.LayerTypes.VECTOR) {\n    // aggiungo il filto bbox\n    let bbox = this._mapService.getMapBBOX();\n    options.filter = {\n      bbox: bbox\n    }\n  }\n  // ritorno opzione\n  return options\n};\n\n// fa lo start di tutte le dipendenze del layer legato alla toolbox che si  avviato\nproto.getLayersDependencyFeatures = function(layerId) {\n  // vado a recuperare le relazioni (figli al momento) di quel paricolare layer\n  /*\n   IMPORTANTE: PER EVITARE PROBLEMI  IMPORTANTE CHE I LAYER DIPENDENTI SIANO A SUA VOLTA EDITABILI\n   */\n  let children = this._editableLayers[layerId].getChildren();\n  let relationChildLayers = children.filter((id) => {\n    return !!this._editableLayers[id];\n  });\n  // se ci sono layer figli dipendenti\n  if (!_.isNil(relationChildLayers) && relationChildLayers.length) {\n    /*\n     * qui andr a verificare se stata istanziata la sessione altrimenti vienne creata\n     * se la sessione  attiva altrimenti viene attivata\n     * */\n    //cerco prima tra i toolbox se presente\n    let session;\n    let toolbox;\n    let options;\n    // cliclo sulle dipendenze create\n    relationChildLayers.forEach((id) => {\n      options = this.createEditingDataOptions(this._editableLayers[id].getType());\n      session = this._sessions[id];\n      toolbox = this.getToolBoxById(id);\n      //setto la propriet a loading\n      toolbox.startLoading();\n      //verifico che ci sia la sessione\n      if (session) {\n        if (!session.isStarted()) {\n          session.start(options)\n            .always(() => {\n              // setto la propri a stop loading sempre\n              toolbox.stopLoading();\n            })\n        } else {\n          session.getFeatures(options)\n            .always(() => {\n              toolbox.stopLoading();\n            })\n        }\n      } else {\n        // altrimenti per quel layer la devo instanziare\n        try {\n          let layer = this._layersstore.getLayerById(id);\n          let editor = layer.getEditor();\n          session = new Session({\n            editor: editor\n          });\n          this._sessions[id] = session;\n          session.start();\n        }\n        catch(err) {\n          console.log(err);\n        }\n      }\n    })\n  }\n};\n\nproto._applyChangesToRelationsAfterCommit = function(commitItemsRelations, relationsResponse) {\n  let layer;\n  let sessionFeaturesStore;\n  let featureStore;\n  let features;\n\n  for (const [layerId, relationResponse] of Object.entries(relationsResponse)) {\n    layer = this.getLayerById(layerId);\n    sessionFeaturesStore = this.getToolBoxById(layerId).getSession().getFeaturesStore();\n    featureStore = layer.getSource();\n    features = _.clone(sessionFeaturesStore.readFeatures());\n    features.forEach((feature) => {\n      feature.clearState();\n    });\n    featureStore.setFeatures(features);\n    layer.applyCommitResponse({\n      response: relationResponse\n    });\n  }\n};\n\nproto.commitDirtyToolBoxes = function(toolboxId) {\n  return new Promise((resolve, reject) => {\n    let toolbox = this.getToolBoxById(toolboxId);\n    if (toolbox.isDirty() && toolbox.hasDependencies()) {\n      this.commit(toolbox)\n        .fail(() => {\n          toolbox.revert()\n            .then(() => {\n              // se ha dipendenze vado a fare il revert delle modifiche fatte\n              toolbox.getDependencies().forEach((toolboxId) => {\n                this.getToolBoxById(toolboxId).revert();\n              })\n            })\n        })\n        .always(() => {\n          resolve(toolbox);\n        })\n    } else\n      resolve(toolbox);\n  });\n};\n\nproto._createCommitMessage = function(commitItems) {\n  function create_changes_list_dom_element(add, update, del) {\n    let changeIds = {\n      Aggiunte: _.map(add, 'id').join(','),\n      Modificate:  _.map(update, 'id').join(','),\n      Cancellate:  del.join(',')\n    };\n    let dom = \"<ul style='border-bottom-color: #f4f4f4;'>\";\n    Object.entries(changeIds).forEach(([action, ids]) => {\n      dom += \"<li>\" + action + \": [\" + ids + \"]</li>\";\n    });\n    dom += \"</ul>\";\n    return dom;\n  }\n\n  let message = \"\";\n  message += create_changes_list_dom_element(commitItems.add, commitItems.update, commitItems.delete);\n  if (!_.isEmpty(commitItems.relations)) {\n    message += \"<div style='height:1px; background:#f4f4f4;border-bottom:1px solid #f4f4f4;'></div>\";\n    message += \"<div style='margin-left: 40%'><h4>Relazioni</h4></div>\";\n    Object.entries(commitItems.relations).forEach(([ relationName, commits]) => {\n      message +=  \"<div><span style='font-weight: bold'>\" + relationName + \"</span></div>\";\n      message += create_changes_list_dom_element(commits.add, commits.update, commits.delete);\n    })\n  }\n  return message;\n};\n\nproto.commit = function(toolbox, close=false) {\n  let d = $.Deferred();\n  toolbox = toolbox || this.state.toolboxselected;\n  let session = toolbox.getSession();\n  let layer = toolbox.getLayer();\n  const layerType = layer.getType();\n  let workflow = new CommitFeaturesWorkflow({\n    type:  'commit'\n  });\n  workflow.start({\n    inputs: {\n      layer: layer,\n      message: this._createCommitMessage(session.getCommitItems()),\n      close: close\n    }})\n    .then(() => {\n      // funzione che serve a fare il commit della sessione legata al tool\n      // qui probabilmente a seconda del layer se ha dipendenze faccio ogni sessione\n      // produrr i suoi dati post serializzati che poi saranno uniti per un unico commit\n      session.commit()\n        .then( (commitItems, response) => {\n          if (response.result) {\n            let relationsResponse = response.response.new_relations;\n            let commitItemsRelations = commitItems.relations;\n            this._applyChangesToRelationsAfterCommit(commitItemsRelations, relationsResponse);\n            GUI.notify.success(t(\"editing.messages.saved\"));\n            if (layerType === 'vector')\n              this._mapService.refreshMap({force: true});\n          } else {\n            const message = response.errors;\n            GUI.notify.error(message);\n          }\n          workflow.stop();\n          d.resolve(toolbox);\n        })\n        .fail( (error) => {\n          let parser = new serverErrorParser({\n            error: error\n          });\n          let message = parser.parse();\n          GUI.notify.error(message);\n          workflow.stop();\n          d.resolve(toolbox);\n        })\n    })\n    .fail(() => {\n      workflow.stop();\n      d.reject(toolbox);\n    });\n  return d.promise();\n};\n\n\nmodule.exports = new EditingService;\n","const GUI = g3wsdk.gui.GUI;\nconst t = g3wsdk.core.i18n.t;\n\n// what we can do with each type of relation element\nconst RELATIONTOOLS = {\n  default: ['editattributes', 'deletefeature'],\n  'table' : [],\n  'Point': ['movefeature'],\n  'LineString': ['movevertex'],\n  'Polygon': ['movefeature', 'movevertex']\n};\n\n// servizio che in base alle relazioni (configurazione)\nconst RelationService = function(options = {}) {\n  this.relation = options.relation;\n  this.relations = options.relations;\n  this._relationTools = [];\n  this._isExternalFieldRequired = false;\n  this._layerId = this.relation.child;\n  this._layerType = this.getLayer().getType();\n  this._relationTools = [];\n  this._add_link_workflow = null; // sono i workflow link e adda che verranmno settati in base al tipo di layer\n  this._isExternalFieldRequired = this._checkIfExternalFieldRequired();\n  // prendo il valore del campo se esiste come propriet altrimenti prendo il valore della chiave primaria\n  this._currentFeatureFatherFieldValue = this.relation.fatherField in this.getCurrentWorkflow().feature.getProperties() ? this.getCurrentWorkflow().feature.get(this.relation.fatherField) : this.getCurrentWorkflow().feature.getId();\n  //get type of relation\n  const relationLayerType = this.getLayer().getType() == 'vector' ? this.getLayer().getGeometryType() : 'table';\n  let allrelationtools;\n  if (relationLayerType == 'table') {\n    this._relationTools.push({\n      state: {\n        icon: 'deleteTableRow.png',\n        id: 'deletefeature',\n        name: t(\"editing.tools.delete_feature\")\n      }\n    });\n    this._relationTools.push({\n      state: {\n        icon: 'editAttributes.png',\n        id: 'editattributes',\n        name: t(\"editing.tools.update_feature\")\n\n      }\n    })\n  } else {\n    allrelationtools = this.getEditingService().getToolBoxById(this.relation.child).getTools();\n    allrelationtools.forEach((tool) => {\n      if(_.concat(RELATIONTOOLS[relationLayerType], RELATIONTOOLS.default).indexOf(tool.getId()) != -1) {\n        this._relationTools.push(_.cloneDeep(tool));\n      }\n    });\n  }\n\n  this._originalLayerStyle = this.getLayer().getType() == 'vector' ? this.getEditingLayer().getStyle() : null;\n  // vado ad aggiungere i workflow per link relation che add new relation\n  this._setAddLinkWorkflow();\n};\n\nconst proto = RelationService.prototype;\n\nproto._setAddLinkWorkflow = function() {\n  const add_link_workflow = {\n    vector: {\n      link: require('../workflows/linkrelationworkflow'),\n      add: require('../workflows/addfeatureworkflow')\n    },\n    table: {\n      link: require('../workflows/edittableworkflow'),\n      add: require('../workflows/addtablefeatureworkflow')\n    }\n  };\n  this._add_link_workflow = add_link_workflow[this._layerType];\n};\n\nproto._getLinkFeatureWorkflow = function() {\n  return new this._add_link_workflow.link();\n};\n\nproto._getAddFeatureWorkflow = function() {\n  return new this._add_link_workflow.add();\n};\n\nproto.getRelationTools = function() {\n  return this._relationTools\n};\n\nproto._highlightRelationSelect = function(relation) {\n  const geometryType = this.getLayer().getGeometryType();\n  let style;\n  if (geometryType == 'LineString' || geometryType == 'MultiLineString') {\n    style = new ol.style.Style({\n      stroke: new ol.style.Stroke({\n        color: 'rgb(255,255,0)',\n        width: 4\n      })\n    });\n  }\n  else if (geometryType == 'Point' || geometryType == 'MultiPoint') {\n    style = new ol.style.Style({\n      image: new ol.style.Circle({\n        radius: 8,\n        fill: new ol.style.Fill({\n          color: 'rgb(255,255,0)'\n        })\n      })\n    });\n  } else if (geometryType == 'MultiPolygon' || geometryType == 'Polygon') {\n    style = new ol.style.Style({\n      stroke: new ol.style.Stroke({\n        color: 'rgb(255,255,0)',\n        width: 4\n      }),\n      fill: new ol.style.Fill({\n        color: 'rgba(255, 255, 0, 0.5)'\n      })\n    });\n  }\n  relation.setStyle(style);\n};\n\n// funzione che lachia la funzione in base al tipo di layer\nproto.startTool = function(relationtool, index) {\n  if (this._layerType == 'vector') {\n    return this.startVectorTool(relationtool, index);\n  }\n  if (this._layerType == 'table') {\n    return this.startTableTool(relationtool, index);\n  }\n};\n\nproto.startTableTool = function(relationtool, index) {\n  const d = $.Deferred();\n  const relation = this.relations[index]; // oggetto relazione\n  const featurestore = this.getEditingService().getToolBoxById(this._layerId).getSession().getFeaturesStore();\n  const relationfeature = featurestore.getFeatureById(relation.id); // relation feature\n  GUI.setModal(false);\n  const options = this._createWorkflowOptions({\n    features: [relationfeature]\n  });\n  let workflow;\n  if (relationtool.state.id == 'deletefeature') {\n    GUI.dialog.confirm(t(\"editing.messages.delete_feature\"), (result) => {\n      if (result) {\n        this.getCurrentWorkflow().session.pushDelete(this._layerId, relationfeature);\n        this.relations.splice(index, 1);\n        featurestore.removeFeature(relationfeature);\n      }\n      d.resolve();\n    });\n  }\n  if (relationtool.state.id == 'editattributes') {\n    const EditTableFeatureWorkflow = require('../workflows/edittablefeatureworkflow');\n    workflow = new EditTableFeatureWorkflow();\n    const percContent = this._bindEscKeyUp(workflow,  function() {});\n    workflow.start(options)\n      .then((output) => {\n        const fields = this._getRelationFieldsValue(relationfeature);\n        fields.forEach((_field) => {\n          relation.fields.forEach((field) => {\n            if (field.name == _field.name)\n              field.value = _field.value;\n          })\n        });\n        d.resolve(output);\n      })\n      .fail((err) => {\n        d.reject(err)\n      })\n      .always(() => {\n        workflow.stop();\n        GUI.hideContent(false, percContent);\n        this._unbindEscKeyUp();\n        GUI.setModal(true);\n      })\n  }\n  return d.promise()\n};\n\nproto.startVectorTool = function(relationtool, index) {\n  const d = $.Deferred();\n  const relation = this.relations[index]; // oggetto relazione\n  const relationfeature = this._getRelationFeature(relation.id); // relation feature\n  const workflows = {\n    ModifyGeometryVertexWorkflow: require('../workflows/modifygeometryvertexworkflow'),\n    MoveFeatureWorkflow : require('../workflows/movefeatureworkflow'),\n    DeleteFeatureWorkflow : require('../workflows/deletefeatureworkflow'),\n    EditFeatureAttributesWorkflow : require('../workflows/editfeatureattributesworkflow')\n  };\n  let workflow;\n  let start;\n  GUI.setModal(false);\n\n  Object.entries(workflows).forEach(([key, classworkflow]) => {\n    if (relationtool.getOperator() instanceof classworkflow) {\n      workflow = new classworkflow();\n      return false;\n    }\n  });\n\n  const options = this._createWorkflowOptions({\n    features: [relationfeature]\n  });\n\n  this._highlightRelationSelect(relationfeature);\n\n  const percContent = this._bindEscKeyUp(workflow,  function() {\n    relation.setStyle(this._originalLayerStyle);\n  });\n\n  if (workflow instanceof workflows.DeleteFeatureWorkflow || workflow instanceof workflows.EditFeatureAttributesWorkflow )\n    start  = workflow.startFromLastStep(options);\n  else\n    start = workflow.start(options);\n  start.then((outputs) => {\n      if (relationtool.getId() == 'deletefeature') {\n        // vado a cambiarli lo style\n        relationfeature.setStyle(this._originalLayerStyle);\n        this.getEditingLayer().getSource().removeFeature(relationfeature);\n        this.getCurrentWorkflow().session.pushDelete(this._layerId, relationfeature);\n        this.relations.splice(index, 1)\n      }\n      if (relationtool.getId() == 'editattributes') {\n        const fields = this._getRelationFieldsValue(relationfeature);\n        fields.forEach((_field) => {\n          relation.fields.forEach((field) => {\n            if (field.name == _field.name)\n              field.value = _field.value;\n          })\n        });\n      }\n      d.resolve(outputs)\n    })\n    .fail((err) => {\n      d.reject(err)\n    })\n    .always(() => {\n      // vado a mettere lo style della relazione\n      this.showRelationStyle();\n      workflow.stop();\n      GUI.hideContent(false, percContent);\n      this._unbindEscKeyUp();\n      GUI.setModal(true);\n    });\n  return d.promise()\n};\n\n// ritorna il layer editable estartto dal layer del catalogo\nproto.getLayer = function() {\n  return this.getEditingService().getLayerById(this.relation.child);\n};\n\n// ritorna il layer che  effettivamente in editing utilizzato dai task\nproto.getEditingLayer = function() {\n  return this.getEditingService().getEditingLayer(this.relation.child);\n};\n\nproto.getEditingService = function() {\n  const EditingService = require('./editingservice');\n  return EditingService;\n};\n\nproto.updateExternalKeyValueRelations = function(input) {\n  const session = this.getEditingService().getToolBoxById(this.relation.father).getSession();\n  const layerId = this.relation.child;\n  if (input.name == this.relation.fatherField) {\n    this._currentFeatureFatherFieldValue = input.value;\n    this.relations.forEach((relation) => {\n      const fields = relation.fields;\n      fields.forEach((field) => {\n        if (field.name == this.relation.childField){\n          field.value = this._currentFeatureFatherFieldValue\n        }\n      });\n      relation = this._getRelationFeature(relation.id);\n      // vado a setare il valore della relazione e aggiornare la sessione\n      const originalRelation = relation.clone();\n      relation.set(this.relation.childField, input.value);\n      if (!relation.isNew()) {\n        session.pushUpdate(layerId, relation, originalRelation);\n      }\n    })\n  }\n};\n\n// funzione che gestisce l'evento keyup esc\nproto._escKeyUpHandler = function(evt) {\n  if (evt.keyCode === 27) {\n    evt.data.workflow.stop();\n    GUI.hideContent(false, evt.data.percContent);\n    evt.data.callback()\n  }\n};\n\n// funzione che fa unbind dell'evento esc key\nproto._unbindEscKeyUp = function() {\n  $(document).unbind('keyup', this._escKeyUpHandler);\n};\n\nproto._bindEscKeyUp = function(workflow, callback) {\n  const percContent = GUI.hideContent(true);\n  $(document).one('keyup', {\n    workflow: workflow,\n    percContent: percContent,\n    callback: callback || function() {}\n  }, this._escKeyUpHandler);\n  return percContent;\n};\n\nproto._getRelationFieldsValue = function(relation) {\n  const layer = this.getLayer();\n  const fields = layer.getFieldsWithValues(relation, {\n    relation: true\n  });\n  return fields;\n};\n\nproto._createRelationObj = function(relation) {\n  return {\n    fields: this._getRelationFieldsValue(relation),\n    id: relation.getId()\n  }\n};\n\nproto.addRelation = function() {\n  GUI.setModal(false);\n  const workflow = this._getAddFeatureWorkflow();\n  const percContent = this._bindEscKeyUp(workflow);\n  const options = this._createWorkflowOptions();\n  workflow.start(options)\n    .then((outputs) => {\n      const relation = outputs.features[outputs.features.length - 1]; // vado a prende l'ultima inserrita\n      // vado a settare il valore\n      relation.set(this.relation.childField, this._currentFeatureFatherFieldValue);\n      this.relations.push(this._createRelationObj(relation));\n    })\n    .fail((err) => {\n    })\n    .always(() =>{\n      GUI.hideContent(false, percContent);\n      this._unbindEscKeyUp();\n      workflow.stop();\n      GUI.setModal(true);\n    });\n};\n\n// funzione che screa lo stile delle relazioni diepndenti riconoscibili con il colore del padre\nproto._getRelationAsFatherStyleColor = function() {\n  const fatherLayerStyle = this.getEditingService().getEditingLayer(this.relation.father).getStyle();\n  const fatherLayerStyleColor = fatherLayerStyle.getFill() ? fatherLayerStyle.getFill() : fatherLayerStyle.getStroke();\n  return fatherLayerStyleColor.getColor();\n};\n\nproto.linkRelation = function() {\n  const workflow = this._getLinkFeatureWorkflow();\n  const percContent = this._bindEscKeyUp(workflow);\n  const options = this._createWorkflowOptions();\n  workflow.start(options)\n    .then((outputs) => {\n      const relation = outputs.features[0];\n      let relationAlreadyLinked = false;\n      this.relations.forEach((rel) => {\n        if (rel.id == relation.getId()) {\n          relationAlreadyLinked = true;\n          return false;\n        }\n      });\n      if (!relationAlreadyLinked) {\n        const originalRelation = relation.clone();\n        relation.set(this.relation.childField, this._currentFeatureFatherFieldValue);\n        this.getCurrentWorkflow().session.pushUpdate(this._layerId , relation, originalRelation);\n        this.relations.push(this._createRelationObj(relation));\n      } else {\n        GUI.notify.warning(t('relation_already_added'));\n      }\n    })\n    .fail((err) => {\n    })\n    .always(() =>{\n      workflow.stop();\n      GUI.hideContent(false, percContent);\n      this._unbindEscKeyUp()\n    });\n};\n\nproto._checkIfExternalFieldRequired = function() {\n  const layerId = this.relation.child;\n  const fieldName = this.relation.childField;\n  return this.getEditingService().isFieldRequired(layerId, fieldName);\n};\n\nproto.isRequired = function() {\n  return this._isExternalFieldRequired;\n};\n\nproto._getRelationFeature = function(featureId) {\n  const editingLayer = this.getEditingLayer();\n  const feature = editingLayer.getSource().getFeatureById(featureId);\n  return feature;\n};\n\nproto.unlinkRelation = function(index) {\n  let relation = this.relations[index];\n  relation = this.getEditingLayer().getSource().getFeatureById(relation.id);\n  const originalRelation = relation.clone();\n  relation.set(this.relation.childField, null);\n  this.getCurrentWorkflow().session.pushUpdate(this._layerId, relation, originalRelation);\n  this.relations.splice(index, 1);\n};\n\n\nproto.getCurrentWorkflow = function() {\n  return this.getEditingService().getCurrentWorflow();\n};\n\nproto._createWorkflowOptions = function(options) {\n  options = options || {};\n  const workflow_options = {\n    context: {\n      session: this.getCurrentWorkflow().session,\n      layer: this.getLayer(),\n      excludeFields: [this.relation.childField],\n      fatherValue: this._currentFeatureFatherFieldValue\n    },\n    inputs: {\n      features: options.features || [],\n      layer: this.getEditingLayer()\n    }\n  };\n  return workflow_options;\n};\n\nproto.showRelationStyle = function() {\n  let style;\n  const layerType = this.getLayer().getType();\n  if (layerType == 'table')\n    return;\n  const geometryType = this.getLayer().getGeometryType();\n  switch (geometryType) {\n    case 'Point' || 'MultiPoint':\n      const color = this._originalLayerStyle.getImage().getFill().getColor();\n      style = new ol.style.Style({\n        image: new ol.style.Circle({\n          radius: 8,\n          fill: new ol.style.Fill({\n            color: color\n          }),\n          stroke: new ol.style.Stroke({\n            width: 5,\n            color:  this._getRelationAsFatherStyleColor()\n          })\n        })\n      });\n      break;\n    case 'Line' || 'MultiLine':\n      style = new ol.style.Style({\n        fill: new ol.style.Fill({\n          color: color\n        }),\n        stroke: new ol.style.Stroke({\n          width: 5,\n          color: this._getRelationAsFatherStyleColor()\n        })\n      });\n      break;\n    case 'Polygon' || 'MultiPolygon':\n      style =  new ol.style.Style({\n        stroke: new ol.style.Stroke({\n          color:  this._getRelationAsFatherStyleColor(),\n          width: 5\n        }),\n        fill: new ol.style.Fill({\n          color: color,\n          opacity: 0.5\n        })\n      })\n  }\n\n  this.relations.forEach((relation) => {\n    let relationfeature = this._getRelationFeature(relation.id);\n    relationfeature.setStyle(style);\n  })\n};\n\n\nproto.hideRelationStyle = function() {\n  if (this._layerType == 'vector') {\n    this.relations.forEach((relation) => {\n      relationfeature = this._getRelationFeature(relation.id);\n      relationfeature.setStyle(this._originalLayerStyle);\n    })\n  }\n};\n\nproto.relationFields = function(relation) {\n  const attributes = [];\n  const originaRelation = this._getRelationFeature(relation.id);\n  _.forEach(relation.fields, function (field) {\n    let value = field.value;\n    if (field.name == originaRelation.getPk() && originaRelation.isNew() && !field.editable)\n      value = null;\n    attributes.push({label: field.label, value: value})\n  });\n  return attributes\n};\n\n\n\nmodule.exports = RelationService;\n","const GUI = g3wsdk.gui.GUI;\nconst t = g3wsdk.core.i18n.t;\n\nconst TableService = function(options = {}) {\n  this._features = options.features || []; // original features\n  this._promise = options.promise;\n  this._context = options.context;\n  this._inputs = options.inputs;\n  this._headers = options.headers;\n  this._fatherValue = options.fatherValue;\n  this._foreignKey = options.foreignKey;\n  this._workflow = null;\n  this.state = {\n    features: [],\n    isrelation: options.isrelation || false, //\n    title: options.title || 'Link relation'\n  };\n  this.init = function() {\n    //filter the original feature based on if is a relation\n    this._features = !this.state.isrelation ? this._features : this._features.filter((feature) => {\n      return feature.get(this._foreignKey) != this._fatherValue\n    });\n    // set values\n    this._features.forEach((feature) => {\n      const properties = feature.getProperties();\n      this.state.features.push(properties);\n    });\n  };\n\n  this.init();\n};\n\nconst proto = TableService.prototype;\n\n\nproto.save = function() {\n  this._promise.resolve();\n};\n\nproto.cancel = function() {\n  this._promise.reject();\n};\n\nproto.deleteFeature = function(index) {\n  GUI.dialog.confirm(t('editing.messages.delete_feature'), (result) => {\n    if (result) {\n      const feature = this._features[index];\n      const session = this._context.session;\n      const layerId = this._inputs.layer.getId();\n      session.pushDelete(layerId, feature);\n      this.state.features.splice(index, 1);\n      this._features.splice(index, 1);\n    }\n  });\n};\n\nproto.editFeature = function(index) {\n  const feature = this._features[index];\n  const EditTableFeatureWorkflow = require('../workflows/edittablefeatureworkflow');\n  this._workflow = new EditTableFeatureWorkflow();\n  const inputs = this._inputs;\n  inputs.features.push(feature);\n  const options = {\n    context: this._context,\n    inputs: inputs\n  };\n  this._workflow.start(options)\n    .then((outputs) => {\n      const feature = outputs.features[0];\n      Object.entries(this.state.features[index]).forEach(([key, value]) => {\n        this.state.features[index][key] = feature.get(key);\n      });\n      const pk = feature.getPk();\n      this.state.features[index][pk] = feature.getId();\n    })\n    .fail((err) => {})\n};\n\nproto.linkFeature = function(index) {\n  const feature = this._features[index];\n  this._promise.resolve({\n      features: [feature]\n    });\n};\n\nproto._setLayout = function() {\n  const editing_table_content_height = $('#editing_table').height();\n  let height_70 = (editing_table_content_height * 70) / 100;\n  return height_70\n};\n\n\n\nmodule.exports = TableService;\n","module.exports = \"<div id=editing_table class=g3w-editing-table> <div class=\\\"box-header with-border\\\"> <h3 class=box-title>{{ state.title }}</h3> <div v-if=state.isrelation style=margin-left:auto> <button @click=stop class=\\\"glyphicon glyphicon-remove pull-right close-panel-button\\\"></button> </div> </div> <table class=display style=width:100%> <thead> <tr> <th v-for=\\\"header in headers\\\">{{ header.label }}</th> <th v-show=!state.isrelation></th> <th v-show=!state.isrelation></th> </tr> </thead> <tbody> <tr @click=\\\"state.isrelation ? linkFeature(index) : null\\\" v-for=\\\"(feature, index) in state.features\\\" :key=index> <td v-if=showValue(key) v-for=\\\"(value, key) in feature\\\"> {{ value }}</td> <td v-show=!state.isrelation> <i class=\\\"fa fa-trash-o\\\" style=cursor:pointer;color:red aria-hidden=true @click=deleteFeature(index)></i> </td> <td v-show=!state.isrelation> <i class=\\\"fa fa-pencil\\\" style=cursor:pointer;color:#3c8dbc aria-hidden=true @click=editFeature(index)></i> </td> </tr> </tbody> </table> <div id=buttons v-show=!state.isrelation style=display:flex;justify-content:center> <div> <button v-t=\\\"'save'\\\" class=\\\"btn btn-success\\\" style=margin-right:10px @click=save></button> <button v-t=\\\"'cancel'\\\" class=\\\"btn btn-primary\\\" @click=cancel></button> </div> </div> </div> \";","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst Component = g3wsdk.gui.vue.Component;\nconst TableService = require('../tableservice');\n\nconst InternalComponent = Vue.extend({\n  template: require('./table.html'),\n  data: function() {\n    return {\n      headers: this.$options.headers,\n      state: null\n    }\n  },\n  methods: {\n    showValue(key) {\n      return !!this.headers.find((header) => {\n        return header.name == key\n      })\n    },\n    stop: function() {\n      this.$options.service.cancel();\n    },\n    save: function() {\n      this.$options.service.save();\n    },\n    cancel: function() {\n      this.$options.service.cancel();\n    },\n    deleteFeature: function(index) {\n      this.$options.service.deleteFeature(index);\n    },\n    editFeature: function(index) {\n      this.$options.service.editFeature(index);\n    },\n    linkFeature: function(index) {\n     this.$options.service.linkFeature(index);\n    },\n    _setLayout: function() {\n      return this.$options.service._setLayout();\n    }\n  },\n  watch: {\n    'state.relations' : function() {\n      this.$nextTick(function() {\n        $(\".nano\").nanoScroller();\n      });\n    }\n  },\n  mounted: function() {\n    this.$nextTick(() => {\n      const maxHeightTable = this._setLayout();\n      $('#editing_table table').DataTable({\n        \"pageLength\": 10,\n        \"scrollX\": true,\n        \"scrollY\": maxHeightTable + 'px',\n        \"scrollCollapse\": true,\n        \"order\": [ 0, 'asc' ],\n        columnDefs: [\n          { orderable: false, targets: [-1, -2] }\n        ]\n      });\n    });\n  }\n});\n\nconst TableComponent = function(options) {\n  base(this);\n  options = options || {};\n  const service = options.service || new TableService({\n    headers: options.headers,\n    features: options.features,\n    promise: options.promise,\n    context: options.context,\n    inputs: options.inputs,\n    isrelation: options.isrelation,\n    fatherValue: options.fatherValue,\n    foreignKey: options.foreignKey,\n    title: options.title\n  });\n  const headers = options.headers || [];\n  // istanzio il componente interno\n  this.setService(service);\n  const internalComponent = new InternalComponent({\n    service: service,\n    headers: headers\n  });\n  this.setInternalComponent(internalComponent);\n  internalComponent.state = service.state;\n\n  this.unmount = function() {\n    return base(this, 'unmount');\n  };\n\n  this.layout = function() {\n    const maxHeightTable = this.getService()._setLayout();\n    $('#editing_table div.dataTables_scrollBody').height( maxHeightTable );\n  }\n};\n\ninherit(TableComponent, Component);\n\n\nmodule.exports = TableComponent;\n\n\n","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst G3WObject = g3wsdk.core.G3WObject;\n\n// Calsse che rappresenta di fatto\n// il bottone all'interno dell'editor control per l'editing\nfunction Tool(options) {\n  base(this);\n  options = options || {};\n  this._session = options.session;\n  // prendo il layer\n  this._layer = options.layer;\n  // gli viene passato l'operatore\n  // l'oggeto che si occuper materialmente di gestire l'editazione del layer\n  // verosimilmente sar un oggetto workflow\n  this._op = new options.op();\n  //stato dell'oggetto tool\n  // reattivo\n  this.state = {\n    id: options.id,\n    name: options.name,\n    enabled: false,\n    active: false,\n    icon: options.icon,\n    message: null,\n    messages: this._op.getMessages()\n  };\n}\n\ninherit(Tool, G3WObject);\n\nconst proto = Tool.prototype;\n\n// funzione che al click del bottone lancio\nproto.start = function() {\n  const options = {};\n  // come inpust al tool e di conseguenza al worflow\n  // passo il layer e features\n  options.inputs = {\n    layer: this._layer,\n    features: []\n  };\n  //passo al context la sessione\n  options.context = {\n    session: this._session,\n    layer: this._session.getEditor().getLayer()\n  };\n  // funzione che mi permette di far ripartire\n  // l'operatore o workflow quando  arrivato alla fine\n  const startOp = (options) => {\n    this._op.on('showtoolsoftool', (tools) => {\n      this.emit('showtoolsoftool', tools);\n    });\n    this._op.start(options)\n      .then((outputs) => {\n        // vado a salvare la sessione\n        this._session.save()\n          .then(() => {});\n      })\n      .fail(() =>  {\n        // in caso di mancato successo faccio il rollback\n        // della sessione da vedere se li\n        const EditingService = require('../services/editingservice');\n        this._session.rollback()\n          .then((relationsChanges) => {\n            EditingService.rollbackRelations(relationsChanges);\n          })\n      })\n      .always(() => {\n        options.inputs.features = [];\n        if (this._session.getEditor().getLayer().getType() != 'table')\n          startOp(options);\n        else\n          this.stop();\n      })\n  };\n  // verifico che sia definito l'operatore\n  if (this._op) {\n    this.state.active = true;\n    // lancio la funzione che mi permette di riavviarea\n    // l'operatore (workflow)  ogni volt  andato a buon fine\n    startOp(options);\n  }\n};\n\n//fa lo stop del tool\nproto.stop = function() {\n  //console.log('Stopping Tool ... ');\n  if (this._op) {\n    this._op.stop()\n      .then(() => {})\n      .fail((err) => {\n        console.log(err);\n        //in caso di errore faccio un rollback della sessione\n        this._session.rollback();\n      })\n      .always(() => {\n        this.state.active = false;\n      })\n  }\n};\n\nproto.getState = function() {\n  return this.state;\n};\n\nproto.setState = function(state) {\n  this.state = state;\n};\n\nproto.getId = function() {\n  return this.state.id;\n};\n\nproto.setId = function(id) {\n  this.state.id = id;\n};\n\nproto.getName = function() {\n  return this.state.name;\n};\n\nproto.setActive = function(bool) {\n  this.state.active = _.isBoolean(bool) ? bool : false;\n};\n\nproto.isActive = function() {\n  return this.state.active;\n};\n\nproto.getIcon = function() {\n  return this.state.icon;\n};\n\nproto.setIcon = function(icon) {\n  this.state.icon = icon;\n};\n\nproto.setEnabled = function(bool) {\n  this.state.enabled = _.isBoolean(bool) ? bool : false;\n};\n\nproto.isEnabled = function() {\n  return this.state.enabled;\n};\n\nproto.getOperator = function() {\n  return this._op;\n};\n\n//restituisce la sessione\nproto.getSession = function() {\n  return this._session;\n};\n\n//setta la sessione\nproto.setSession = function(session) {\n  this._session = session;\n};\n\nproto.clear = function() {\n  this.state.enabled = false;\n  this.state.active = false;\n};\n\nproto.getMessage = function() {\n  const operator = this.getOperator();\n  return operator.getRunningStep() ? this.state.messages : null;\n};\n\nproto.setMessage = function(message) {\n  this.state.message = message;\n};\n\nproto.clearMessage = function() {\n  this.state.message = null;\n};\n\nmodule.exports = Tool;\n","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst G3WObject = g3wsdk.core.G3WObject;\nconst GUI = g3wsdk.gui.GUI;\nconst Layer = g3wsdk.core.layer.Layer;\nconst Session = g3wsdk.core.editing.Session;\nconst OlFeaturesStore = g3wsdk.core.layer.features.OlFeaturesStore;\nconst FeaturesStore = g3wsdk.core.layer.features.FeaturesStore;\n\nfunction ToolBox(options={}) {\n  base(this);\n  // editor del Layer che permette di interagire con il layer\n  // save, etc ...\n  this._editor = options.editor;\n  // l'editing layer originale che contiene tutte le informazioni anche le relazioni\n  this._layer = this._editor.getLayer();\n  //layer ol della mappa\n  this._editingLayer = options.layer;\n  // recupero il tipo di toolbox\n  this._layerType = options.type || 'vector';\n  this._loadedExtent = null;\n  this._tools = options.tools;\n  // optioni per il recupero delle feature\n  this._getFeaturesOption = {};\n  // popolo gl'array degli state del tools appartenenti al toobox\n  const toolsstate = [];\n  this._tools.forEach((tool) => {\n    toolsstate.push(tool.getState())\n  });\n  //sessione che permette di gestire tutti i movimenti da parte\n  // dei tools del toolbox durante l'editing del layer\n  //creo la sessione passandogli l'editor\n  this._session = new Session({\n    id: options.id, // contiene l'id del layer\n    editor: this._editor,\n    featuresstore: this._layerType == Layer.LayerTypes.VECTOR ? new OlFeaturesStore(): new FeaturesStore()\n  });\n  // opzione per recuperare le feature\n  this._getFeaturesOption = {};\n  // stato della history\n  const historystate = this._session.getHistory().state;\n  const sessionstate = this._session.state;\n  // stato del toolbox;\n  this.state = {\n    id: options.id,\n    // colore del layer (dar il colore alla maschera) e quindi\n    // delle feature visualizzate sulla mappa\n    color: options.color || 'blue',\n    title: options.title || \"Edit Layer\",\n    loading: false,\n    enabled: false,\n    message: null,\n    toolmessages: {\n      help: null\n    },\n    toolsoftool: [], // tools to show when a task request this\n    tools: toolsstate,\n    selected: false, //proprie che mi server per switchare tra un toolbox e un altro\n    activetool: null, // tiene conto del tool attivo corrente\n    editing: {\n      session: sessionstate, // STATE DELLA SESSIONE\n      history: historystate,// assegno lo state della history\n      on: false,\n      dependencies: [], // array di id dei toolbox dipendenti, utili per accendere spendere editing e chiedere il commit\n      relations: [],\n      father: false\n    },\n    layerstate: this._layer.state\n  };\n  //vado a settare la sessione ad ogni tool di quel toolbox\n  // e lo stesso toolbox\n  this._tools.forEach((tool) => {\n    tool.setSession(this._session);\n  });\n\n  // in ascolto dell'onafter start della sessione cos se avviata\n  // vado ad associare le features del suo featuresstore al ol.layer.Vector\n  this._session.onafter('stop', () => {\n    const EditingService = require('../services/editingservice');\n    //vado a fermare la sessione dei figli\n    EditingService.stopSessionChildren(this.state.id);\n    // vado a unregistrare gli eventi\n    this._unregisterGetFeaturesEvent();\n  });\n\n  this._session.onafter('start', (options) => {\n    this._getFeaturesOption = options;\n    const EditingService = require('../services/editingservice');\n    // passo id del toolbox e le opzioni per far partire la sessione\n    EditingService.getLayersDependencyFeatures(this.state.id);// dove le opzioni possono essere il filtro;\n    // vado a registrare l'evento getFeature\n    this._registerGetFeaturesEvent(this._getFeaturesOption);\n  });\n\n  // mapservice mi servir per fare richieste al server sulle features (bbox) quando agisco sull mappa\n  this._mapService = GUI.getComponent('map').getService();\n  //eventi per catturare le feature\n  this._getFeaturesEvent = {\n    event: null,\n    fnc: null,\n    options: {\n      extent: null\n    }\n  };\n  // vado a settare il source all'editing layer\n  this._setEditingLayerSource();\n}\n\ninherit(ToolBox, G3WObject);\n\nconst proto = ToolBox.prototype;\n\nproto.getLayer = function() {\n  return this._layer;\n};\n\nproto.getEditingLayer = function() {\n  return this._editingLayer;\n};\n\nproto.setFather = function(bool) {\n  this.state.editing.father = bool;\n};\n\nproto.isFather = function() {\n  return this.state.editing.father;\n};\n\nproto.addRelations = function(relations) {\n  relations.forEach((relation) => {\n    this.addRelation(relation);\n  })\n};\n\nproto.revert = function() {\n  return this._session.revert();\n};\n\nproto.addRelation = function(relation) {\n  this.state.editing.relations.push(relation);\n};\n\nproto.getDependencies = function() {\n  return this.state.editing.dependencies;\n};\n\nproto.hasDependencies = function() {\n  return !!this.state.editing.dependencies.length;\n};\n\nproto.addDependencies = function(dependencies) {\n  dependencies.forEach((dependency) => {\n    this.addDependency(dependency);\n  })\n};\n\nproto.addDependency = function(dependency) {\n  this.state.editing.dependencies.push(dependency);\n};\n\n// funzione che permette di settare il featurestore del session in particolare\n// collezioni di features per quanto riguarda il vector layer e da vedere per il table layer (forse array) al table layer\nproto._setEditingLayerSource = function() {\n  // vado a prendere\n  const featuresstore = this._session.getFeaturesStore();\n  let source;\n  // questo ritorna come promessa l'array di features del featuresstore\n  // vado  a settare il source del layer\n  if (this._layerType == Layer.LayerTypes.VECTOR) {\n    source = new ol.source.Vector({features: featuresstore.getFeaturesCollection() });\n  } else {\n    source  = featuresstore;\n  }\n  //setto come source del layer l'array / collection feature del features sotre della sessione\n  // il layer deve implementare anche un setSource\n  this._editingLayer.setSource(source);\n};\n\n// funzione che fa in modo di attivare tutti i tasks associati\n// al controllo. Questo verr eventualmente chiamato o dalla pennina di start editing\n// o quando schiacchio il bottone generale Avvia editing\n// inoltre far uno start e stop dell'editor\nproto.start = function() {\n  const EditingService = require('../services/editingservice');\n  const d = $.Deferred();\n  // vado a recuperare l'oggetto opzioni data per poter richiedere le feature al provider\n  this._getFeaturesOption = EditingService.createEditingDataOptions(this._layerType);\n  // se non  stata avviata da altri allora faccio avvio sessione\n  if (this._session) {\n    if (!this._session.isStarted()) {\n      // setto il loding dei dati a true\n      this.state.loading = true;\n      this._session.start(this._getFeaturesOption)\n        .then((promise) => {\n          promise\n            .then((features) => {\n              this.state.loading = false;\n              this.setEditing(true);\n            })\n            .fail((err) => {\n              console.log(err);\n              this.stop();\n              d.reject(err);\n            })\n        })\n    } else {\n      this.setEditing(true);\n    }\n  }\n  return d.promise();\n};\n\nproto.startLoading = function() {\n  this.state.loading = true;\n};\n\nproto.stopLoading = function() {\n  this.state.loading = false;\n};\n\n\nproto.getFeaturesOption = function() {\n  return this._getFeaturesOption;\n};\n\n// funzione che disabiliter\nproto.stop = function() {\n  // le sessioni dipendenti per poter eseguier l'editing\n  const d = $.Deferred();\n  if (this._session && this._session.isStarted()) {\n    //vado a verificare se  c' un padre in editing\n    const EditingService = require('../services/editingservice');\n    const is_there_a_father_in_editing = EditingService.fatherInEditing(this.state.id);\n    if (!is_there_a_father_in_editing) {\n      this._session.stop()\n        .then(() => {\n          this.state.editing.on = false;\n          this.state.enabled = false;\n          this.state.loading = false;\n          this._getFeaturesOption = {};\n          // spengo il tool attivo\n          this.stopActiveTool();\n          // seci sono tool attivi vado a spengere\n          this._setToolsEnabled(false);\n          this.clearToolboxMessages();\n          d.resolve(true)\n        })\n        .fail((err) => {\n          // mostro un errore a video o tramite un messaggio nel pannello\n          d.reject(err)\n        });\n    } else {\n      // spengo il tool attivo\n      this.stopActiveTool();\n      // seci sono tool attivi vado a spengere\n      this.state.editing.on = false;\n      this._setToolsEnabled(false);\n      this.clearToolboxMessages();\n      this._unregisterGetFeaturesEvent();\n      EditingService.stopSessionChildren(this.state.id);\n    }\n  } else {\n    d.resolve(true)\n  }\n  return d.promise();\n};\n\n//funzione salvataggio modifiche\nproto.save = function () {\n  this._session.commit();\n};\n\n// unregistra eventi che sono legati al getFeatures\nproto._unregisterGetFeaturesEvent = function() {\n  switch(this._layerType) {\n    case 'vector':\n      this._mapService.getMap().un(this._getFeaturesEvent.event, this._getFeaturesEvent.fnc);\n      this._getFeaturesEvent.options.extent = null;\n      break;\n    default:\n      return;\n  }\n};\n\n// funzione che ha lo scopo di registrare gli eventi per catturare le feature\nproto._registerGetFeaturesEvent = function(options) {\n  // le sessioni dipendenti per poter eseguier l'editing\n  switch(this._layerType) {\n    case Layer.LayerTypes.VECTOR:\n      const fnc = _.bind(function(options) {\n        // get current map extent bbox\n        const bbox = this._mapService.getMapBBOX();\n        // get loadedExtent\n        if (this._getFeaturesEvent.options.extent && ol.extent.containsExtent(this._getFeaturesEvent.options.extent, bbox)) {\n          return;\n        }\n        if (!this._getFeaturesEvent.options.extent) {\n          this._getFeaturesEvent.options.extent = bbox;\n        } else {\n          this._getFeaturesEvent.options.extent = ol.extent.extend(this._getFeaturesEvent.options.extent, bbox);\n        }\n        options.filter.bbox = bbox;\n        this._session.getFeatures(options);\n      }, this, options);\n      this._getFeaturesEvent.event = 'moveend';\n      this._getFeaturesEvent.fnc = fnc;\n      this._mapService.getMap().on('moveend', fnc);\n      break;\n    default:\n      return;\n  }\n};\n\nproto._setToolsEnabled = function(bool) {\n  this._tools.forEach((tool) => {\n    tool.setEnabled(bool);\n    if (!bool)\n      tool.setActive(bool);\n  })\n};\n\nproto.setMessage = function(message) {\n  this.state.message = message;\n};\n\nproto.getMessage = function() {\n  return this.state.message;\n};\n\nproto.clearMessage = function() {\n  this.setMessage(null);\n};\n\nproto.clearToolboxMessages = function() {\n  this.clearToolMessage();\n  this.clearMessage();\n};\n\nproto.getId = function() {\n  return this.state.id;\n};\n\nproto.setId = function(id) {\n  this.state.id = id;\n};\n\nproto.getTitle = function() {\n  return this.state.title;\n};\n\nproto.getColor = function() {\n  return this.state.color;\n};\n\nproto.getLayer = function() {\n  return this._layer;\n};\n\nproto.setEditing = function(bool) {\n  this.setEnable(bool);\n  this.state.editing.on = bool;\n  this.enableTools(bool);\n};\n\nproto.inEditing = function() {\n  return this.state.editing.on;\n};\n\nproto.isEnabled = function() {\n  return this.state.enabled;\n};\n\nproto.setEnable = function(bool) {\n  this.state.enabled = _.isBoolean(bool) ? bool : false;\n  return this.state.enabled;\n};\n\nproto.isLoading = function() {\n  return this.state.loading;\n};\n\nproto.isDirty = function() {\n  return this.state.editing.history.commit;\n};\n\nproto.isSelected = function() {\n  return this.state.selected;\n};\n\nproto.setSelected = function(bool) {\n  this.state.selected = _.isBoolean(bool) ? bool : false;\n};\n\nproto.getTools = function() {\n  return this._tools;\n};\n\nproto.getToolById = function(toolId) {\n  let Tool = null;\n  this._tools.forEach((tool) => {\n    if (toolId == tool.getId()) {\n      Tool = tool;\n      return false\n    }\n  });\n  return Tool;\n};\n\nproto.enableTools = function(bool) {\n  this._tools.forEach((tool) => {\n    tool.setEnabled(bool);\n  })\n};\n\n// funzione che attiva il tool\nproto.setActiveTool = function(tool) {\n  // prima stoppo l'eventuale active tool\n  this.stopActiveTool(tool);\n  this.clearToolsOfTool();\n  // faccio partire lo start del tool\n  this.state.activetool = tool;\n  // registro l'evento sul workflow\n  tool.on('showtoolsoftool', (tools) => {\n    this.state.toolsoftool = tools;\n  });\n  tool.start();\n  const message = this.getToolMessage();\n  this.setToolMessage(message);\n};\n\nproto.clearToolsOfTool = function() {\n  this.state.toolsoftool = [];\n};\n\nproto.getActiveTool = function() {\n  return this.state.activetool;\n};\n\nproto.restartActiveTool = function() {\n  const activeTool = this.getActiveTool();\n  this.stopActiveTool();\n  this.setActiveTool(activeTool);\n};\n\nproto.stopActiveTool = function(tool) {\n  const activeTool = this.getActiveTool();\n  if (activeTool && activeTool != tool) {\n    activeTool.stop();\n    this.clearToolMessage();\n    this.state.activetool = null;\n  }\n};\n\nproto.clearToolMessage = function() {\n  this.state.toolmessage = null;\n};\n\nproto.getToolMessage = function() {\n  const tool = this.getActiveTool();\n  return tool.getMessage();\n};\n\nproto.setToolMessage = function(messages) {\n  this.state.toolmessages = messages;\n};\n\nproto.getSession = function() {\n  return this._session;\n};\n\nproto.getEditor = function() {\n  return this._editor;\n};\n\nproto.setEditor = function(editor) {\n  this._editor = editor;\n};\n\n//PARTE DEDICATA ALLE RELAZIONI\n\nproto.hasChildren = function() {\n  return this._layer.hasChildren();\n};\n\nproto.hasFathers = function() {\n  return this._layer.hasFathers();\n};\n\nproto.hasRelations = function() {\n  return this._layer.hasRelations();\n};\n\n\nmodule.exports = ToolBox;\n","const Layer = g3wsdk.core.layer.Layer;\nconst GUI = g3wsdk.gui.GUI;\nconst EditToolsFactory = require('./toolsfactory');\nconst ToolBox = require('./toolbox');\n\n// classe costruttrice di ToolBoxes\nfunction EditorToolBoxesFactory() {\n  this._mapService = GUI.getComponent('map').getService();\n  // metodo adibito alla costruzione dell'Editor Control\n  // e dei tasks associati\n  // il layer  il layer di editing originale da cui tutte le feature\n  // verranno chiamate tramite il featuresstore provider\n  this.build = function(layer) {\n    // estraggo il layer dell'editor\n    const editor = layer.getEditor();\n    // estraggo il tipo di layer\n    const layerType = layer.getType();\n    const layerId = layer.getId();\n    // definisce il layer che sar assegnato al toolbox e ai tools\n    let editingLayer;\n    let tools;\n    switch (layerType) {\n      // caso layer editabile vettoriale\n      case Layer.LayerTypes.VECTOR:\n        const geometryType = layer.getGeometryType();\n        // vado a recuperare il layer (ol.Layer) della mappa\n        // su cui tutti i tool agiranno\n        editingLayer = this._mapService.getLayerById(layerId);\n        tools = EditToolsFactory.build({\n          layer: editingLayer,\n          geometryType: geometryType,\n          type: layerType\n        });\n        break;\n      // caso layer tabellare da mettere in piedi\n      case Layer.LayerTypes.TABLE:\n        // vado a clonar il layer per utilizzarlo nei vari task\n        editingLayer = _.cloneDeep(layer);\n        tools = EditToolsFactory.build({\n          layer: editingLayer,\n          type: layerType\n        });\n        break;\n      default:\n        tools = [];\n        break;\n    }\n    return new ToolBox({\n      id: layer.getId(),\n      color: layer.getColor(),\n      type: layerType,\n      editor: editor,\n      layer: editingLayer,\n      tools: tools,\n      title: \"Edit \" + layer.getName()\n    })\n  };\n}\n\nmodule.exports = new EditorToolBoxesFactory;\n","const Layer = g3wsdk.core.layer.Layer;\nconst Geometry = g3wsdk.core.geometry.Geometry;\nconst t = g3wsdk.core.i18n.t;\nconst Tool = require('./tool');\nconst AddFeatureWorkflow = require('../workflows/addfeatureworkflow');\nconst ModifyGeometryVertexWorkflow = require('../workflows/modifygeometryvertexworkflow');\nconst MoveFeatureWorkflow = require('../workflows/movefeatureworkflow');\nconst DeleteFeatureWorkflow = require('../workflows/deletefeatureworkflow');\nconst EditFeatureAttributesWorkflow = require('../workflows/editfeatureattributesworkflow');\nconst EditTableFeaturesWorkflow = require('../workflows/edittableworkflow');\nconst AddTableFeatureWorflow = require('../workflows/addtablefeatureworkflow');\n\n// classe costruttrice di Tools\nfunction EditorToolsFactory() {\n  // create a single tool\n  this.buildTool = function(options) {\n    //TODO\n  };\n  // e dei tasks associati\n  this.build = function(options) {\n    options = options || {};\n    const type = options.type || Layer.LayerTypes.VECTOR;\n    const layer = options.layer;\n    let tools;\n    switch (type) {\n      case Layer.LayerTypes.VECTOR:\n        const geometryType = options.geometryType;\n        switch (geometryType) {\n          case Geometry.GeometryTypes.POINT:\n          case Geometry.GeometryTypes.MULTIPOINT:\n            tools = [\n              new Tool({\n                id: 'addfeature',\n                name: t(\"editing.tools.add_feature\"),\n                icon: \"addPoint.png\",\n                layer: layer,\n                op: AddFeatureWorkflow\n              }),\n              new Tool({\n                id: 'movefeature',\n                name: t(\"editing.tools.move_feature\"),\n                icon: \"movePoint.png\",\n                layer: layer,\n                type: type,\n                op: MoveFeatureWorkflow\n              }),\n              new Tool({\n                id: 'deletefeature',\n                name: t(\"editing.tools.delete_feature\"),\n                icon: \"deletePoint.png\",\n                layer: layer,\n                op: DeleteFeatureWorkflow\n              }),\n              new Tool({\n                id: 'editattributes',\n                name: t(\"editing.tools.update_feature\"),\n                icon: \"editAttributes.png\",\n                layer: layer,\n                op: EditFeatureAttributesWorkflow\n              })\n            ];\n            break;\n          case Geometry.GeometryTypes.LINESTRING:\n          case Geometry.GeometryTypes.MULTILINESTRING:\n          case Geometry.GeometryTypes.LINE:\n          case Geometry.GeometryTypes.MULTILINE:\n            tools = [\n              new Tool({\n                id: 'addfeature',\n                name: t(\"editing.tools.add_feature\"),\n                icon: \"addLine.png\",\n                layer: layer,\n                type: type,\n                op: AddFeatureWorkflow\n              }),\n              new Tool({\n                id: 'movevertex',\n                name: t(\"editing.tools.update_vertex\"),\n                icon: \"moveVertex.png\",\n                layer: layer,\n                op: ModifyGeometryVertexWorkflow\n              }),\n              new Tool({\n                id: 'deletefeature',\n                name: t(\"editing.tools.delete_feature\"),\n                icon: \"deleteLine.png\",\n                layer: layer,\n                op: DeleteFeatureWorkflow\n              }),\n              new Tool({\n                id: 'editattributes',\n                name: t(\"editing.tools.update_feature\"),\n                icon: \"editAttributes.png\",\n                layer: layer,\n                op: EditFeatureAttributesWorkflow\n              })\n            ];\n            break;\n          case Geometry.GeometryTypes.POLYGON:\n          case Geometry.GeometryTypes.MULTIPOLYGON:\n            tools = [\n              new Tool({\n                id: 'addfeature',\n                name: t(\"editing.tools.add_feature\"),\n                icon: \"AddPolygon.png\",\n                layer: layer,\n                op: AddFeatureWorkflow\n              }),\n              new Tool({\n                id: 'movefeature',\n                name: t(\"editing.tools.move_feature\"),\n                icon: \"MovePolygon.png\",\n                layer: layer,\n                op: MoveFeatureWorkflow\n              }),\n              new Tool({\n                id: 'movevertex',\n                name: t(\"editing.tools.update_vertex\"),\n                icon: \"MovePolygonVertex.png\",\n                layer: layer,\n                op: ModifyGeometryVertexWorkflow\n              }),\n              new Tool({\n                id: 'deletefeature',\n                name: t(\"editing.tools.delete_feature\"),\n                icon: \"deletePolygon.png\",\n                layer: layer,\n                op: DeleteFeatureWorkflow\n              }),\n              new Tool({\n                id: 'editattributes',\n                name: t(\"editing.tools.update_feature\"),\n                icon: \"editAttributes.png\",\n                layer: layer,\n                op: EditFeatureAttributesWorkflow\n              })\n            ];\n            break;\n        }\n        break;\n      // caso layer tabellare da mettere in piedi\n      case Layer.LayerTypes.TABLE:\n        tools = [\n          new Tool({\n            id: 'addfeature',\n            name: t(\"editing.tools.add_feature\"),\n            icon: \"addTableRow.png\",\n            layer: layer,\n            op: AddTableFeatureWorflow\n          }),\n          new Tool({\n            id: 'edittable',\n            name: t(\"editing.tools.update_feature\"),\n            icon: \"editAttributes.png\",\n            layer: layer,\n            op: EditTableFeaturesWorkflow\n          })\n        ];\n        break;\n      default:\n        tools = [];\n        break;\n    }\n    return tools\n  };\n}\n\nmodule.exports = new EditorToolsFactory;\n","module.exports = \"<div @click=\\\"state.enabled ? toggletool(): null\\\" class=editbtn :class=\\\"{'enabled' : state.enabled, 'toggled' : state.active}\\\"> <img height=30px width=30px :alt=state.name :title=state.name :src=\\\"resourcesurl + 'images/'+ state.icon\\\"/> </div>\";","var ToolComponent = Vue.extend({\n  template: require('./tool.html'),\n  props: ['state' ,'resourcesurl'],\n  data: function() {\n    return {}\n  },\n  methods: {\n    toggletool: function() {\n      // se non  attivo lo attivo emettendo il segnale\n      if (!this.state.active) {\n        this.$emit('setactivetool', this.state.id);\n      } else {\n        this.$emit('stopactivetool');\n      }\n    }\n  }\n});\n\n// dichairo il componente tool in generale da poter esserre riutilizzato\nVue.component('tool', ToolComponent);\n\nmodule.exports = ToolComponent;\n\n\n","module.exports = \"<div class=toolbox> <div :class=\\\"{'disableddiv' : !isLayerReady }\\\" :id=\\\"'id_toolbox_'+ state.id\\\"> <div @click=select class=\\\"panel panel-primary\\\" :class=\\\"{ 'toolboxselected': state.selected }\\\"> <div class=\\\"panel-heading container\\\" style=width:100% :style=\\\"{ background: state.color}\\\"> <div v-if=father style=margin-right:5px class=\\\"pull-left enabled dropdown\\\"> <img height=20px width=20px class=dropbtn data-toggle=dropdown :src=\\\"resourcesurl + 'images/relation.png'\\\"/> <div class=dropdown-content style=padding:5px> <div v-for=\\\"dependency in state.editing.dependencies\\\" style=color:#000>{{ dependency }}</div> </div> </div> <div class=panel-title :class=\\\"[father ? 'col-md-6' : 'col-md-8']\\\"> {{ state.title }} </div> <div @click=toggleEditing class=\\\"editbtn pull-right\\\" :class=\\\"{'enabled' : isLayerReady,  'g3w-icon-toggled' : state.editing.on}\\\"> <span style=font-size:15px class=\\\"g3w-icon g3w-edit\\\"></span> </div> </div> <div class=panel-body> <tool :state=toolstate :resourcesurl=resourcesurl @stopactivetool=stopActiveTool @setactivetool=setActiveTool v-for=\\\"toolstate in state.tools\\\"> </tool> <div class=message style=margin-top:5px :id=\\\"'id_toolbox_messages_'+ state.id\\\"> <div v-html=state.message></div> <div v-html=toolhelpmessage></div> <toolsoftool v-show=state.toolsoftool.length :tools=state.toolsoftool></toolsoftool> <div v-t=\\\"'editing.messages.loading_data'\\\" v-show=state.loading><img style=padding-left:3px :src=\\\"resourcesurl + '/images/loader.svg'\\\"></div> </div> </div> </div> </div> </div> \";","const ToolComponent = require('./tool');\nconst ToolsOfToolComponent = require('./toolsoftool');\n\nconst ToolboxComponent = Vue.extend({\n  template: require('./toolbox.html'),\n  props: ['state', 'resourcesurl'],\n  data: function() {\n    return {\n      active: false,\n      showtoolsoftool: true\n    }\n  },\n  components: {\n    'tool': ToolComponent,\n    'toolsoftool': ToolsOfToolComponent\n  },\n  methods: {\n    select: function() {\n      if (!this.isLayerReady())\n        return;\n      if (!this.state.selected) {\n        this.$emit('setselectedtoolbox', this.state.id);\n      }\n    },\n    toggleEditing() {\n      //se il toolbox non  ancora abilitato non faccio niente\n      if (!this.state.layerstate.editing.ready)\n        return;\n      this.state.editing.on ? this.$emit('stoptoolbox', this.state.id): this.$emit('starttoolbox', this.state.id);\n    },\n    saveEdits() {\n      this.$emit('savetoolbox', this.state.id);\n    },\n    // funzione che visualizza il toolbox appena sono disponibili le configurazioni\n    // fields (passato dal metodo perch in grado di ricevere parametri)\n    isLayerReady() {\n      return this.state.layerstate.editing.ready;\n    },\n    stopActiveTool() {\n      this.$emit('stopactivetool', this.state.id);\n    },\n    setActiveTool(toolId) {\n      this.$emit('setactivetool', toolId, this.state.id);\n    },\n    loadToolsOfTools(tools) {\n      this.showtoolsoftool = tools.length;\n    }\n  },\n  computed: {\n    father: function() {\n      return this.state.editing.father && !!this.state.editing.dependencies.length;\n    },\n    toolhelpmessage() {\n      return this.state.toolmessages.help;\n    }\n  }\n});\n\nmodule.exports = ToolboxComponent;\n\n\n","module.exports = \"<div id=toolsoftoolcontainer style=\\\"display:flex;margin:5px;padding:5px;border:1px solid #000;background-color:#fff;border-radius:5px\\\"> <div v-for=\\\"tool in tools\\\" class=tooloftool> </div> </div> \";","const Tools = require('./toolsoftool/tools');\n\nvar ToolsOfToolComponent = Vue.extend({\n  template: require('./toolsoftool.html'),\n  props: ['tools'],\n  components: {\n    Tools\n  },\n  data: function() {\n    return {}\n  },\n  methods: {\n    toggletool: function() {}\n  }\n});\n\nmodule.exports = ToolsOfToolComponent;\n","const Tools = {\n  snap: require('./snap.vue')\n};\n\nmodule.exports = Tools;\n","module.exports = \"<div class=g3w-editing-panel> <div> <div class=\\\"editbtn pull-right\\\" @click=\\\"canRedo ? redo(): null\\\" :class=\\\"{'enabled' : canRedo }\\\"> <span class=\\\"g3w-icon g3w-redo\\\"></span> </div> <div class=\\\"editbtn pull-right\\\" @click=\\\"canUndo ? undo(): null\\\" :class=\\\"{'enabled' : canUndo }\\\"> <span class=\\\"g3w-icon g3w-undo\\\"></span> </div> <div class=\\\"editbtn pull-right\\\" @click=\\\"canCommit ? commit(): null\\\" :class=\\\"{'enabled' : canCommit }\\\"> <span class=\\\"g3w-icon g3w-saveedit\\\"></span> </div> <div style=display:inline-block> <ul class=\\\"nav navbar-nav\\\"> <li class=\\\"dropdown messages-menu\\\"> <a href=# class=dropdown-toggle data-toggle=dropdown> <span class=\\\"g3w-icon g3w-envelop\\\"></span> <span v-if=state.message class=\\\"label label-info\\\">1</span> </a> <div v-if=state.message class=dropdown-menu style=width:320px;min-height:100px;padding:5px> <div class=warning-message v-html=state.message></div> </div> </li> </ul> </div> </div> <div id=toolboxes> <toolbox :state=toolboxstate :resourcesurl=resourcesurl @setselectedtoolbox=setSelectedToolbox @starttoolbox=startToolBox @stoptoolbox=stopToolBox @savetoolbox=saveToolBox @setactivetool=startActiveTool @stopactivetool=stopActiveTool v-for=\\\"toolboxstate in state.toolboxes\\\"> </toolbox> </div> </div> \";","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst merge =  g3wsdk.core.utils.merge;\nconst t = g3wsdk.core.i18n.t;\nconst GUI = g3wsdk.gui.GUI;\nconst Component = g3wsdk.gui.vue.Component;\nconst EditingService = require('../services/editingservice');\nconst EditingTemplate = require('./editing.html');\nconst ToolboxComponent = require('./components/toolbox');\n\nconst vueComponentOptions = {\n  template: EditingTemplate,\n  data: null,\n  components: {\n    'toolbox': ToolboxComponent //componente toolbox\n\n  },\n  transitions: {'addremovetransition': 'showhide'},\n  methods: {\n    undo: function() {\n      const session = this.state.toolboxselected.getSession();\n      const undoItems = session.undo(); // questi solo le feature (cambiamenti) che devo applicare al features stores dei singoli layers coinvolti\n      this.$options.service.undoRelations(undoItems)\n    },\n    redo: function() {\n      const session = this.state.toolboxselected.getSession();\n      const redoItems = session.redo();\n      this.$options.service.redoRelations(redoItems)\n    },\n    commit: function(toolboxId) {\n      const toolbox = this.$options.service.getToolBoxById(toolboxId);\n      this.$options.service.commit(toolbox)\n        .always((toolbox) => {\n          toolbox.restartActiveTool()\n        })\n    },\n    saveAll: function() {},\n    startToolBox: function(toolboxId) {\n      const toolbox = this._getToolBoxById(toolboxId);\n      toolbox.start();\n    },\n    stopToolBox: function(toolboxId) {\n      const toolbox = this._getToolBoxById(toolboxId);\n      if (toolbox.state.editing.history.commit)\n        this.$options.service.commit()\n          .always(function() {\n            toolbox.stop()\n          });\n      else\n        toolbox.stop();\n    },\n    saveToolBox: function(toolboxId) {\n      const toolbox = this._getToolBoxById(toolboxId);\n      toolbox.save();\n    },\n    _setActiveToolOfToolbooxSelected: function(toolId, toolboxId) {\n      const toolbox = this._getToolBoxById(toolboxId);\n      this.state.toolboxidactivetool = toolboxId;\n      const tool = toolbox.getToolById(toolId);\n      toolbox.setActiveTool(tool);\n    },\n    startActiveTool: function(toolId, toolboxId) {\n      // vado a verificare se l'id dell toolbox attivo  diverso o meno da quello premuto\n      if (this.state.toolboxidactivetool && toolboxId != this.state.toolboxidactivetool) {\n        this._checkDirtyToolBoxes(this.state.toolboxidactivetool)\n          .then((toolbox) => {\n            // vado a stoppare l'eventuale tool attivo del precedente toolbox\n            if (toolbox)\n              toolbox.stopActiveTool();\n            this._setActiveToolOfToolbooxSelected(toolId, toolboxId);\n          })\n      } else {\n        this._setActiveToolOfToolbooxSelected(toolId, toolboxId);\n      }\n    },\n    stopActiveTool: function(toolboxId) {\n      const toolbox = this._getToolBoxById(toolboxId);\n      toolbox.stopActiveTool();\n    },\n    setSelectedToolbox: function(toolboxId) {\n      const service = this.$options.service;\n      const toolbox = this._getToolBoxById(toolboxId);\n      const toolboxes = service.getToolBoxes();\n      _.forEach(toolboxes, function(toolbox) {\n        if (toolbox.isSelected()) {\n          toolbox.setSelected(false);\n          return false;\n        }\n      });\n      toolbox.setSelected(true);\n      this.state.toolboxselected = toolbox;\n      if (toolbox.getDependencies().length) {\n        this.state.message = \"<div>\\n\" +\n          t(\"editing.messages.change_toolbox_relation\") + \"\\n\" +\n          \"</div>\"\n      } else {\n        this.state.message = null;\n      }\n    },\n    _checkDirtyToolBoxes: function(toolboxId) {\n      return this.$options.service.commitDirtyToolBoxes(toolboxId);\n    },\n    // funzione che mi va a aprendere dal service il toolbox in base al suo id\n    _getToolBoxById: function(toolboxId) {\n      const service = this.$options.service;\n      const toolbox = service.getToolBoxById(toolboxId);\n      return toolbox;\n    }\n  },\n  computed: {\n    // messaggio generale dell'editing esempio comunicando che il layer\n    // che stiamo editindo  padre e quindi i figli sono disabilitati\n    message: function() {\n      const message = \"\";\n      return message;\n    },\n    canCommit: function() {\n      return this.state.toolboxselected && this.state.toolboxselected.state.editing.history.commit;\n    },\n    canUndo: function() {\n      const toolbox = this.state.toolboxselected;\n      return !_.isNull(toolbox) &&  toolbox.state.editing.history.undo;\n    },\n    canRedo: function() {\n      const toolbox = this.state.toolboxselected;\n      return !_.isNull(toolbox) && toolbox.state.editing.history.redo;\n    }\n  },\n  mounted() {\n    this.$nextTick(() => {})\n  }\n};\n\nfunction PanelComponent(options) {\n  // propriet necessarie. In futuro le mettermo in una classe Panel\n  // da cui deriveranno tutti i pannelli che vogliono essere mostrati nella sidebar\n  base(this, options);\n  // qui vado a tenere traccia delle due cose che mi permettono di customizzare\n  // vue component e service\n  this.vueComponent = vueComponentOptions;\n  this.name = options.name || 'Gestione dati';\n  merge(this, options);\n  // resource urls\n  this._resourcesUrl = options.resourcesUrl || GUI.getResourcesUrl();\n  this._service = options.service || EditingService;\n  // setto il componente interno\n  const InternalComponent = Vue.extend(this.vueComponent);\n  this.internalComponent = new InternalComponent({\n    service: this._service,\n    data: () => {\n      return {\n        //lo state  quello del servizio in quanto  lui che va a modificare operare sui dati\n        state: this._service.state,\n        resourcesurl: this._resourcesUrl\n      }\n    }\n  });\n\n  // sovrascrivo richiamando il padre in append\n  this.mount = function(parent) {\n    return base(this, 'mount', parent, true)\n  };\n\n  this.unmount = function() {\n    const d = $.Deferred();\n    //vado a fare lo stop del servizio che fa un po di pulizia\n    this._service.stop()\n      .then(() => {\n        //vado a riscrivere la propriet\n        this.unmount = function() {\n          base(this, 'unmount')\n            .then(() => {\n              d.resolve()\n            });\n        };\n        this.unmount();\n      });\n    return d.promise();\n  };\n\n}\n\ninherit(PanelComponent, Component);\n\nmodule.exports = PanelComponent;\n\n\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingWorkflow = require('./editingworkflow');\nvar AddFeatureStep = require('./steps/addfeaturestep');\nvar OpenFormStep = require('./steps/openformstep');\n\nfunction AddFeatureWorflow(options) {\n  options = options || {};\n  options.steps = [new AddFeatureStep(), new OpenFormStep()];\n  base(this, options);\n}\n\ninherit(AddFeatureWorflow, EditingWorkflow);\n\nmodule.exports = AddFeatureWorflow;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingWorkflow = require('./editingworkflow');\nvar AddTableFeatureStep = require('./steps/addtablefeaturestep');\nvar OpenFormStep = require('./steps/openformstep');\n\nfunction AddTableFeatureWorflow(options) {\n  options = options || {};\n  options.steps = [new AddTableFeatureStep(), new OpenFormStep()];\n  base(this, options);\n}\n\ninherit(AddTableFeatureWorflow, EditingWorkflow);\n\nmodule.exports = AddTableFeatureWorflow;","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingWorkflow = require('./editingworkflow');\nvar ConfirmStep = require('./steps/confirmstep');\n\nfunction CommitFeatureWorflow(options) {\n  options = options || {};\n  options.steps = [new ConfirmStep(options)];\n  base(this, options);\n}\n\ninherit(CommitFeatureWorflow, EditingWorkflow);\n\nvar proto = CommitFeatureWorflow.prototype;\n\nmodule.exports = CommitFeatureWorflow;","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst EditingWorkflow = require('./editingworkflow');\nconst DeleteFeatureStep = require('./steps/deletefeaturestep');\nconst ConfirmStep = require('./steps/confirmstep');\n\nfunction DeleteFeatureWorflow(options) {\n  options = options || {};\n  options.steps = [new DeleteFeatureStep(), new ConfirmStep({\n    type: 'delete'}\n    )];\n  base(this, options);\n}\n\ninherit(DeleteFeatureWorflow, EditingWorkflow);\n\nmodule.exports = DeleteFeatureWorflow;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingWorkflow = require('./editingworkflow');\nvar PickFeatureStep = require('./steps/pickfeaturestep');\nvar OpenFormStep = require('./steps/openformstep');\n\nfunction EditFeatureAttributesWorkflow(options) {\n  options = options || {};\n  // workflow composto da due steps:\n  // Il primo servre per fare selezionare la feature\n  // il secondo per aprire il form\n  options.steps = [new PickFeatureStep(), new OpenFormStep()];\n  base(this, options);\n}\n\ninherit(EditFeatureAttributesWorkflow, EditingWorkflow);\n\nvar proto = EditFeatureAttributesWorkflow.prototype;\n\nmodule.exports = EditFeatureAttributesWorkflow;","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst Workflow = g3wsdk.core.workflow.Workflow;\n\n\nfunction EditingWorkflow(options={}) {\n  base(this, options);\n  this._toolsoftool = [];\n}\n\ninherit(EditingWorkflow, Workflow);\n\nconst proto = EditingWorkflow.prototype;\n\nproto.getFeatures = function() {\n  return this.getInputs().features;\n};\n\nproto.setToolsOfTool = function(tools=[]) {\n  this._toolsoftool = [tools]\n};\n\nproto.startFromLastStep = function(options) {\n  let steps = this.getSteps();\n  this.setSteps([steps.pop()]);\n  return this.start(options);\n};\n\nproto.getCurrentFeature = function() {\n  const features = this.getFeatures();\n  const length = this.getFeatures().length;\n  return features[length -1];\n};\n\nproto.getLayer = function() {\n  return this.getSession().getEditor().getLayer()\n};\n\nproto.getSession = function() {\n  return this.getContext().session;\n};\n\nmodule.exports = EditingWorkflow;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingWorkflow = require('./editingworkflow');\nvar OpenFormStep = require('./steps/openformstep');\n\nfunction EditTableFeatureWorflow(options) {\n  options = options || {};\n  options.steps = [new OpenFormStep()];\n  base(this, options);\n}\n\ninherit(EditTableFeatureWorflow, EditingWorkflow);\n\nmodule.exports = EditTableFeatureWorflow;","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingWorkflow = require('./editingworkflow');\nvar OpenTableStep = require('./steps/opentablestep');\n\nfunction EditTableFeaturesWorkflow(options) {\n  options = options || {};\n\n  options.steps = [new OpenTableStep()];\n  base(this, options);\n}\n\ninherit(EditTableFeaturesWorkflow, EditingWorkflow);\n\nmodule.exports = EditTableFeaturesWorkflow;","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingWorkflow = require('./editingworkflow');\nvar LinkRelationStep = require('./steps/linkrelationstep');\n\nfunction LinkRelationWorflow(options) {\n  options = options || {};\n  options.steps = [new LinkRelationStep()];\n  base(this, options);\n}\n\ninherit(LinkRelationWorflow, EditingWorkflow);\n\nmodule.exports = LinkRelationWorflow;","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingWorkflow = require('./editingworkflow');\nvar PickFeatureStep = require('./steps/pickfeaturestep');\nvar ModifyGeometryVertexStep = require('./steps/modifygeometryvertexstep');\n\nfunction ModifyGeometryVertexWorflow(options={}) {\n  const pickstep = new PickFeatureStep(options);\n  pickstep.on('run', ({inputs, context}) => {\n    const layer = inputs.layer;\n    this.emit('showtoolsoftool', [\n      {\n        type: 'snap',\n        options: layer.getSource()\n      }\n    ])\n  });\n  const modifyvertex = new ModifyGeometryVertexStep();\n  options.steps = [pickstep, modifyvertex];\n  base(this, options);\n}\n\ninherit(ModifyGeometryVertexWorflow, EditingWorkflow);\n\nmodule.exports = ModifyGeometryVertexWorflow;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingWorkflow = require('./editingworkflow');\nvar PickFeatureStep = require('./steps/pickfeaturestep');\nvar MoveFeatureStep = require('./steps/movefeaturestep');\n\nfunction MoveFeatureWorflow(options) {\n  options = options || {};\n  options.steps = [new PickFeatureStep(), new MoveFeatureStep()];\n  base(this, options);\n}\n\ninherit(MoveFeatureWorflow, EditingWorkflow);\n\nvar proto = MoveFeatureWorflow.prototype;\n\nmodule.exports = MoveFeatureWorflow;","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingStep = require('./editingstep');\nvar AddFeatureTask = require('./tasks/addfeaturetask');\n\nvar AddFeatureStep = function(options={}) {\n  options.task = new AddFeatureTask(options);\n  options.help = \"editing.steps.help.draw_new_feature\";\n  base(this, options)\n};\n\ninherit(AddFeatureStep, EditingStep);\n\nmodule.exports = AddFeatureStep;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar Step = g3wsdk.core.workflow.Step;\nvar AddFeatureTableTask = require('./tasks/addfeaturetabletask');\n\n//creato uno step per apriore il form\nvar AddTableFeatureStep = function(options) {\n  options = options || {};\n  options.task = new AddFeatureTableTask();\n  options.help = \"editing.steps.help.new\";\n  base(this, options)\n};\n\ninherit(AddTableFeatureStep, Step);\n\nmodule.exports = AddTableFeatureStep;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingStep = require('./editingstep');\nvar ConfirmTask = require('./tasks/confirmtask');\n\nvar ConfirmStep = function(options) {\n  options = options || {};\n  options.task = new ConfirmTask(options);\n  //options.help = \"editing.steps.help.action_confirm\";\n  base(this, options)\n};\n\ninherit(ConfirmStep, EditingStep);\n\nmodule.exports = ConfirmStep;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingStep = require('./editingstep');\nvar DeleteFeatureTask = require('./tasks/deletefeaturetask');\n\nvar DeleteFeatureStep = function(options) {\n  options = options || {};\n  options.task = new DeleteFeatureTask();\n  options.help = \"editing.steps.help.double_click_delete\";\n  base(this, options)\n};\n\ninherit(DeleteFeatureStep, EditingStep);\n\nmodule.exports = DeleteFeatureStep;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar Step = g3wsdk.core.workflow.Step;\n\nvar EditingStep = function(options) {\n  base(this, options)\n};\n\ninherit(EditingStep, Step);\n\nmodule.exports = EditingStep;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingStep = require('./editingstep');\nvar LinkRelationTask = require('./tasks/linkrelationtask');\n\nvar LinkRelationStep = function(options) {\n  options = options || {};\n  options.task = new LinkRelationTask();\n  options.help = \"editing.steps.help.select_feature_to_relation\";\n  base(this, options)\n};\n\ninherit(LinkRelationStep, EditingStep);\n\nmodule.exports = LinkRelationStep;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingStep = require('./editingstep');\nvar ModifyGeometryVertexTask = require('./tasks/modifygeometryvertextask');\n\nvar ModifyGeometryVertexStep = function(options={snap: true}) {\n  const task = new ModifyGeometryVertexTask(options);\n  options.task = task;\n  options.help = \"editing.steps.help.edit_feature_vertex\";\n  base(this, options)\n};\n\ninherit(ModifyGeometryVertexStep, EditingStep);\n\nmodule.exports = ModifyGeometryVertexStep;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingStep = require('./editingstep');\nvar MoveFeatureTask = require('./tasks/movefeaturettask');\n\nvar MoveFeatureStep = function(options) {\n  options = options || {};\n  options.task = new MoveFeatureTask();\n  options.help = \"editing.steps.help.move\";\n  base(this, options)\n};\n\ninherit(MoveFeatureStep, EditingStep);\n\nmodule.exports = MoveFeatureStep;\n","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst Step = g3wsdk.core.workflow.Step;\nconst OpenFormTask = require('./tasks/openformtask');\n\n//creato uno step per apriore il form\nconst OpenFormStep = function(options) {\n  options = options || {};\n  options.task = new OpenFormTask();\n  options.help = \"editing.steps.help.insert_attributes_feature\";\n  base(this, options)\n};\n\ninherit(OpenFormStep, Step);\n\nmodule.exports = OpenFormStep;\n","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst Step = g3wsdk.core.workflow.Step;\nconst OpenTableTask = require('./tasks/opentabletask');\n\n//creato uno step per apriore il form\nconst OpenTableStep = function(options) {\n  options = options || {};\n  options.task = new OpenTableTask();\n  options.help = \"editing.steps.help.edit_table\";\n  base(this, options)\n};\n\ninherit(OpenTableStep, Step);\n\nmodule.exports = OpenTableStep;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar Step = g3wsdk.core.workflow.Step;\nvar PickFeatureTask = require('./tasks/pickfeaturetask');\n\n//creato uno step per permettere di fare il pickfeature\nvar PickFeatureStep = function(options={}) {\n  const task = new PickFeatureTask(options);\n  options.task = task ;\n  options.help = \"editing.steps.help.pick_feature\";\n  base(this, options)\n};\n\ninherit(PickFeatureStep, Step);\n\nmodule.exports = PickFeatureStep;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar EditingTask = require('./editingtask');\n\nfunction AddFeatureTableTask(options) {\n  options = options || {};\n  base(this, options);\n}\n\ninherit(AddFeatureTableTask, EditingTask);\n\nvar proto = AddFeatureTableTask.prototype;\n\n// metodo eseguito all'avvio del tool\nproto.run = function(inputs, context) {\n  var d = $.Deferred();\n  var originalLayer = context.layer;\n  var layerId = originalLayer.getId();\n  // l'etiing layer in realt  la session per i layer tabellari\n  var editingLayer = inputs.layer;\n  var session = context.session;\n  // nella creazione della nuova feature utilizzo l'editing layer originale (TableLayer)\n  var feature = originalLayer.createNewFeature();\n  session.pushAdd(layerId, feature);\n  editingLayer.getSource().addFeature(feature);\n  inputs.features.push(feature);\n  d.resolve(inputs);\n  return d.promise();\n};\n\n\nmodule.exports = AddFeatureTableTask;\n","const inherit = g3wsdk.core.utils.inherit;\nconst Layer = g3wsdk.core.layer.Layer;\nconst Geometry = g3wsdk.core.geometry.Geometry;\nconst base =  g3wsdk.core.utils.base;\nconst EditingTask = require('./editingtask');\nconst Feature = g3wsdk.core.layer.features.Feature;\n\n// classe  per l'aggiuntadi feature\n// eridita dalla classe padre EditingTool\nfunction AddFeatureTask(options={}) {\n  this._busy = false;\n  // source del layer di editing\n  // la drw interaction per disegnare la feature\n  this.drawInteraction = null;\n  this._snap = options.snap===false ? false : true;\n  this._snapInteraction = null;\n  this._finishCondition = options.finishCondition || _.constant(true);\n  this._condition = options.condition || _.constant(true);\n\n  base(this, options);\n}\n\ninherit(AddFeatureTask, EditingTask);\n\nconst proto = AddFeatureTask.prototype;\n\n// metodo eseguito all'avvio del tool\nproto.run = function(inputs, context) {\n  /*\n    originalLayer :  il layer di editing originale\n    editingLayer:  il layer, in questo caso ol.layer.Vector con cui gli strumenti interagiscono\n   */\n  const d = $.Deferred();\n  const editingLayer = inputs.layer;\n  //recupero la sessione dal context\n  const session = context.session;\n  const originalLayer = context.layer;\n  const layerId = originalLayer.getId();\n  // vado a rrecuperare la primary key del layer\n  const pk = originalLayer.getPk();\n  // qui vado a valutare il tipo di layer\n  switch (originalLayer.getType()) {\n    case Layer.LayerTypes.VECTOR:\n      let geometryType;\n      if (originalLayer.getEditingGeometryType() == Geometry.GeometryTypes.LINE)\n        geometryType = 'LineString';\n      else if (originalLayer.getEditingGeometryType() == Geometry.GeometryTypes.MULTILINE)\n        geometryType = 'MultiLineString';\n      else\n        geometryType = originalLayer.getEditingGeometryType();\n      //definisce l'interazione che deve essere aggiunta\n      // specificando il layer sul quale le feature aggiunte devono essere messe\n      const source = editingLayer.getSource();\n      const attributes = _.filter(originalLayer.getFields(), function(field) {\n        return field.editable && field.name != originalLayer.getPk() ;\n      });\n      // creo una source temporanea\n      const temporarySource = new ol.source.Vector();\n      this.drawInteraction = new ol.interaction.Draw({\n        type: geometryType, // il tipo lo prende dal geometry type dell'editing vetor layer che a sua volta lo prende dal tipo si geometry del vector layer originale\n        source: temporarySource, // lo faccio scrivere su una source temporanea (non vado a modificare il source featuresstore)\n        condition: this._condition,\n        finishCondition: this._finishCondition // disponibile da https://github.com/openlayers/ol3/commit/d425f75bea05cb77559923e494f54156c6690c0b\n      });\n      //aggiunge l'interazione tramite il metodo generale di editor.js\n      // che non fa altro che chaimare il mapservice\n      this.addInteraction(this.drawInteraction);\n      //setta attiva l'interazione\n      this.drawInteraction.setActive(true);\n      // viene settato sull'inizio del draw l'evento drawstart dell'editor\n      this.drawInteraction.on('drawstart',function(e) {\n      });\n      // viene settato l'evento drawend\n      this.drawInteraction.on('drawend', function(e) {\n        console.log('Drawend .......');\n        // vado ad assegnare le propri del layer alla nuova feature\n        _.forEach(attributes, function(attribute) {\n          e.feature.set(attribute.name, null);\n        });\n        const feature = new Feature({\n          feature: e.feature,\n          pk: pk // passo la pk della feature\n        });\n        // verifico se la pk  editabile o meno\n        originalLayer.isPkEditable() ?  feature.setNew() : feature.setTemporaryId();\n        // lo setto come add feature lo state\n        // vado a aggiungerla\n        source.addFeature(feature);\n        //source.readFeatures().push(feature);\n        // devo creare un clone per evitare che quando eventualmente sposto la feature appena aggiunta\n        // questa non sovrascriva le feature nuova originale del primo update\n        session.pushAdd(layerId, feature);\n        inputs.features.push(feature);\n        d.resolve(inputs);\n      });\n      //snapping\n      if (this._snap) {\n        this._snapInteraction = new ol.interaction.Snap({\n          source: editingLayer.getSource()\n        });\n        this.addInteraction(this._snapInteraction);\n      }\n      break;\n  }\n  return d.promise();\n};\n\n\n// metodo eseguito alla disattivazione del tool\nproto.stop = function() {\n  console.log('stop add task ...');\n  //rimuove e setta a null la _snapInteraction\n  if (this._snapInteraction) {\n     this.removeInteraction(this._snapInteraction);\n     this._snapInteraction = null;\n  }\n  //rimove l'interazione e setta a null drawInteracion\n  this.removeInteraction(this.drawInteraction);\n  this.drawInteraction = null;\n  // rtirna semprte true\n  return true;\n};\n\nproto._removeLastPoint = function() {\n  if (this.drawInteraction) {\n    // provo a rimuovere l'ultimo punto. Nel caso non esista la geometria gestisco silenziosamente l'errore\n    try{\n      this.drawInteraction.removeLastPoint();\n    }\n    catch (e) {\n      //\n    }\n  }\n};\n\nmodule.exports = AddFeatureTask;\n","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst GUI = g3wsdk.gui.GUI;\nconst t = g3wsdk.core.i18n.t;\nconst EditingTask = require('./editingtask');\n\n// oggetto che contiene tutte le timpologie di dialog, confirm etc ...\nlet Dialogs = {\n  delete: {\n    fnc: function(inputs) {\n      let d = $.Deferred();\n      GUI.dialog.confirm(t(\"editing.messages.delete_feature\"), function(result) {\n        if (result)\n          d.resolve(inputs);\n        else\n          d.reject(inputs);\n      });\n      return d.promise();\n    }\n  },\n  commit: {\n    fnc: function(inputs) {\n      let d = $.Deferred();\n      let close = inputs.close;\n      const buttons = {\n          SAVE: {\n            label: t(\"save\"),\n            className: \"btn-success\",\n            callback: function () {\n            d.resolve(inputs);\n          }\n        },\n        CANCEL: {\n          label: close ? t(\"exitnosave\") : t(\"annul\"),\n          className: \"btn-primary\",\n          callback: function () {\n            d.reject();\n          }\n        }\n      };\n      // NOW I HAVE TO IMPLEMENT WHAT HAPPEND ID NO ACTION HAPPEND\n      GUI.dialog.dialog({\n        message: inputs.message,\n        title: t(\"editing.messages.commit\") + \" \" +inputs.layer.getName() + \"?\",\n        buttons: buttons\n      });\n      return d.promise()\n    }\n  }\n};\n\nfunction ConfirmTask(options) {\n  let type = options.type || \"default\";\n  this._dialog = Dialogs[type];\n  base(this, options);\n}\n\ninherit(ConfirmTask, EditingTask);\n\nlet proto = ConfirmTask.prototype;\n\n// metodo eseguito all'avvio del tool\nproto.run = function(inputs, context) {\n  console.log('Confirm Feature Task run ....');\n  return this._dialog.fnc(inputs);\n};\n\n// metodo eseguito alla disattivazione del tool\nproto.stop = function(){\n  return true;\n};\n\n\n\nmodule.exports = ConfirmTask;\n","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst DeleteInteraction = g3wsdk.ol3.interactions.DeleteFeatureInteraction;\nconst EditingTask = require('./editingtask');\n\nfunction DeleteFeatureTask(options) {\n  this.drawInteraction = null;\n  this._selectInteraction = null;\n  base(this, options);\n}\n\ninherit(DeleteFeatureTask, EditingTask);\n\n\nconst proto = DeleteFeatureTask.prototype;\n\n/* BRUTTISSIMO! Tocca ridefinire tutte le parti internet di OL3 non esposte dalle API */\n\nol.geom.GeometryType = {\n  POINT: 'Point',\n  LINE_STRING: 'LineString',\n  LINEAR_RING: 'LinearRing',\n  POLYGON: 'Polygon',\n  MULTI_POINT: 'MultiPoint',\n  MULTI_LINE_STRING: 'MultiLineString',\n  MULTI_POLYGON: 'MultiPolygon',\n  GEOMETRY_COLLECTION: 'GeometryCollection',\n  CIRCLE: 'Circle'\n};\n\n\nconst white = [255, 255, 255, 1];\nconst red = [255, 0, 0, 1];\nconst width = 3;\n\n//vado a definre lo stile della feature selezionata per essere cancellata\nconst styles = {};\nstyles[ol.geom.GeometryType.POLYGON] = [\n  new ol.style.Style({\n    stroke: new ol.style.Stroke({\n      color: 'red',\n      width: 3\n    }),\n    fill: new ol.style.Fill({\n      color: 'rgba(255, 0, 0, 0.1)'\n    })\n  })\n];\nstyles[ol.geom.GeometryType.MULTI_POLYGON] = styles[ol.geom.GeometryType.POLYGON];\n\nstyles[ol.geom.GeometryType.LINE_STRING] = [\n  new ol.style.Style({\n    stroke: new ol.style.Stroke({\n      color: white,\n      width: width + 2\n    })\n  }),\n  new ol.style.Style({\n    stroke: new ol.style.Stroke({\n      color: red,\n      width: width\n    })\n  })\n];\n\nstyles[ol.geom.GeometryType.MULTI_LINE_STRING] = styles[ol.geom.GeometryType.LINE_STRING];\n\nstyles[ol.geom.GeometryType.CIRCLE] = styles[ol.geom.GeometryType.POLYGON].concat(styles[ol.geom.GeometryType.LINE_STRING]);\n\nstyles[ol.geom.GeometryType.POINT] = [\n  new ol.style.Style({\n    image: new ol.style.Circle({\n      radius: width * 2,\n      fill: new ol.style.Fill({\n        color: red\n      }),\n      stroke: new ol.style.Stroke({\n        color: white,\n        width: width / 2\n      })\n    }),\n    zIndex: Infinity\n  })\n];\nstyles[ol.geom.GeometryType.MULTI_POINT] = styles[ol.geom.GeometryType.POINT];\n\nstyles[ol.geom.GeometryType.GEOMETRY_COLLECTION] = styles[ol.geom.GeometryType.POLYGON].concat(styles[ol.geom.GeometryType.LINE_STRING], styles[ol.geom.GeometryType.POINT]);\n\nstyles[ol.geom.GeometryType.POLYGON] = _.concat(styles[ol.geom.GeometryType.POLYGON],styles[ol.geom.GeometryType.LINE_STRING]);\n\nstyles[ol.geom.GeometryType.GEOMETRY_COLLECTION] = _.concat(styles[ol.geom.GeometryType.GEOMETRY_COLLECTION],styles[ol.geom.GeometryType.LINE_STRING]);\n\n/* FINE BRUTTISSIMO! */\n\n// run del tool di delete feature\n// che ritorna una promessa\nproto.run = function(inputs, context) {\n  console.log('Delete task run.......');\n  var self = this;\n  var d = $.Deferred();\n  var editingLayer = inputs.layer;\n  var originaLayer = context.layer;\n  var layerId = originaLayer.getId();\n  //recupero la sessione dal context\n  var session = context.session;\n  this._selectInteraction = new ol.interaction.Select({\n    layers: [editingLayer],\n    condition: ol.events.condition.click,\n    style: function(feature) {\n      var style = styles[feature.getGeometry().getType()];\n      return style;\n    }\n  });\n  this.addInteraction(this._selectInteraction);\n  this._deleteInteraction = new DeleteInteraction({\n    features: this._selectInteraction.getFeatures(), // passo le features selezionate\n    layer: editingLayer // il layer appartenente\n  });\n  this.addInteraction(this._deleteInteraction);\n  this._deleteInteraction.on('deleteend', function(e) {\n    const feature = e.features.getArray()[0];\n    const EditingService = require('../../../services/editingservice');\n    const RelationService = require('../../../services/relationservice');\n    const relations = originaLayer.getRelations()? originaLayer.getRelations().getArray() : [];\n    const relationsInEditing = EditingService.getRelationsInEditing(relations, feature, feature.isNew());\n    inputs.features = [feature];\n    relationsInEditing.forEach((relation) => {\n      let updateRelation = true;\n      let relationService = new RelationService({\n        relation: relation.relation,\n        relations: relation.relations\n      });\n      EditingService.getLayerById(relation.relation.child).getFields().forEach((field) => {\n        if (field.name == relation.relation.childField && field.validate.required)\n          updateRelation = false;\n      });\n      if (updateRelation) {\n        const relationsLength = relation.relations.length;\n        for (let index = 0; index < relationsLength ; index++) {\n          relationService.unlinkRelation(0)\n        }\n      }\n    });\n    // vado a cancellare dalla source la feature selezionata\n    editingLayer.getSource().removeFeature(feature);\n    self._selectInteraction.getFeatures().remove(feature);\n    // dico di cancellarla (la feature non viene cancellatata ma aggiornato il suo stato\n    session.pushDelete(layerId, feature);\n    //dovrei aggiungere qui qualcosa per salvare temporaneamente quesa modifica sulla sessione al fine di\n    // portare tutte le modifiche quando viene fatto il save della sessione\n    // ritorno come outpu l'input layer che sar modificato\n    d.resolve(inputs);\n  });\n  return d.promise();\n};\n\nproto.stop = function() {\n  console.log('Stop delete task ....');\n  return new Promise((resolve, reject) => {\n    this._selectInteraction.getFeatures().clear();\n    this.removeInteraction(this._selectInteraction);\n    this._selectInteraction = null;\n    // funzione che mi fa il resete di tuttle le modalit inserite dall'interazione\n    this._deleteInteraction.clear();\n    this.removeInteraction(this._deleteInteraction);\n    this._deleteInteraction = null;\n    resolve(true);\n  })\n\n};\n\n\nmodule.exports = DeleteFeatureTask;\n","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst GUI = g3wsdk.gui.GUI;\nconst Task = g3wsdk.core.workflow.Task;\n\nfunction EditingTask(options) {\n  options = options || {};\n  base(this, options);\n  // da vedere meglio\n  this._mapService = GUI.getComponent('map').getService();\n  this.addInteraction = function(interaction) {\n    this._mapService.addInteraction(interaction);\n  };\n// rimuovo un'interazione\n  this.removeInteraction = function(interaction) {\n    this._mapService.removeInteraction(interaction);\n  };\n}\n\ninherit(EditingTask, Task);\n\nconst proto = EditingTask.prototype;\n\nproto.run = function(inputs, context) {\n  //TODO\n};\n\nproto.stop = function() {\n  //TODO\n};\n\nmodule.exports = EditingTask;\n","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst EditingTask = require('./editingtask');\nconst GUI = g3wsdk.gui.GUI;\nconst PickFeatureInteraction = g3wsdk.ol3.interactions.PickFeatureInteraction;\n\n\n// classe  per l'aggiungere una relazione\nfunction LinkRelationTask(options) {\n  options = options || {};\n  base(this, options);\n}\n\ninherit(LinkRelationTask, EditingTask);\n\nconst proto = LinkRelationTask.prototype;\n\n// metodo eseguito all'avvio del tool\nproto.run = function(inputs, context) {\n  const d = $.Deferred();\n  GUI.setModal(false);\n  const originalLayer = context.layer;\n  const layerType = originalLayer.getType();\n  //var style = this.editor._editingVectorStyle ? this.editor._editingVectorStyle.edit : null;\n  // vado a settare i layers su cui faccio l'interacion agisce\n  const editingLayer = inputs.layer;\n  if (layerType == 'vector') {\n    this.pickFeatureInteraction = new PickFeatureInteraction({\n      layers: [editingLayer]\n    });\n    // aggiungo\n    this.addInteraction(this.pickFeatureInteraction);\n    // gestisco l'evento\n    this.pickFeatureInteraction.on('picked', function(e) {\n      const relation = e.feature;\n      inputs.features.push(relation);\n      GUI.setModal(true);\n      d.resolve(inputs);\n    });\n  } else {\n\n  }\n\n  return d.promise()\n};\n\n// metodo eseguito alla disattivazione del tool\nproto.stop = function() {\n  GUI.setModal(true);\n  this.removeInteraction(this.pickFeatureInteraction);\n  this.pickFeatureInteraction = null;\n  return true;\n};\n\n\nmodule.exports = LinkRelationTask;\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\n\nvar EditingTask = require('./editingtask');\n\nfunction ModifyGeometryVertexTask(options={}){\n  this.drawInteraction = null;\n  this._originalStyle = null;\n  this._feature = null;\n  this._deleteCondition = options.deleteCondition || undefined;\n  this._snap = options.snap === false ? false : true;\n  this._snapInteraction = null;\n  base(this, options);\n}\n\ninherit(ModifyGeometryVertexTask, EditingTask);\n\n\nvar proto = ModifyGeometryVertexTask.prototype;\n\nproto.run = function(inputs, context) {\n  var d = $.Deferred();\n  var editingLayer = inputs.layer;\n  var session = context.session;\n  var originalLayer = context.layer;\n  var layerId = originalLayer.getId();\n  var originalFeature,\n    newFeature;\n  var feature = this._feature = inputs.features[0];\n  this._originalStyle = editingLayer.getStyle();\n  var style = [\n    new ol.style.Style({\n      stroke : new ol.style.Stroke({\n        color : \"grey\",\n        width: 3\n      })\n    }),\n    new ol.style.Style({\n      image: new ol.style.Circle({\n        radius: 5,\n        fill: new ol.style.Fill({\n          color: 'orange'\n        })\n      }),\n      geometry: function(feature) {\n        // return the coordinates of the first ring of the polygon\n        var coordinates = feature.getGeometry().getCoordinates()[0];\n        return new ol.geom.MultiPoint(coordinates);\n      }\n    })\n  ];\n  feature.setStyle(style);\n  var features = new ol.Collection(inputs.features);\n  this._modifyInteraction = new ol.interaction.Modify({\n    features: features,\n    deleteCondition: this._deleteCondition\n  });\n\n  this.addInteraction(this._modifyInteraction);\n\n  this._modifyInteraction.on('modifystart', function(e) {\n    var feature = e.features.getArray()[0];\n    originalFeature = feature.clone();\n  });\n\n  this._modifyInteraction.on('modifyend',function(e){\n    var feature = e.features.getArray()[0];\n    if (feature.getGeometry().getExtent() != originalFeature.getGeometry().getExtent()) {\n      newFeature = feature.clone();\n      session.pushUpdate(layerId, newFeature, originalFeature);\n      //self._selectInteraction.getFeatures().clear();\n      inputs.features.push(newFeature);\n      // ritorno come outpu l'input layer che sar modificato\n      d.resolve(inputs);\n    }\n  });\n\n  if (this._snap) {\n    this._snapInteraction = new ol.interaction.Snap({\n      source: editingLayer.getSource()\n    });\n    this.addInteraction(this._snapInteraction);\n  }\n\n  return d.promise();\n};\n\n\nproto.stop = function(){\n  if (this._snapInteraction) {\n     this.removeInteraction(this._snapInteraction);\n     this._snapInteraction = null;\n  }\n  this._feature.setStyle(this._originalStyle);\n  this.removeInteraction(this._modifyInteraction);\n  this._modifyInteraction = null;\n  return true;\n};\n\n\nproto.removePoint = function(coordinate){\n  if (this._modifyInteraction) {\n    // provo a rimuovere l'ultimo punto. Nel caso non esista la geometria gestisco silenziosamente l'errore\n    try{\n      this._modifyInteraction.removePoint();\n    }\n    catch (e){\n      console.log(e);\n    }\n  }\n};\n\n\n\nproto._isNew = function(feature){\n  return (!_.isNil(this.editingLayer.getSource().getFeatureById(feature.getId())));\n};\n\nmodule.exports = ModifyGeometryVertexTask;\n","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst EditingTask = require('./editingtask');\n\nfunction MoveFeatureTask(options){\n  this.drawInteraction = null;\n  base(this, options);\n}\n\ninherit(MoveFeatureTask, EditingTask);\n\nconst proto = MoveFeatureTask.prototype;\n\nproto.run = function(inputs, context) {\n  const d = $.Deferred();\n  const session = context.session;\n  const editingLayer = inputs.layer;\n  const feature = inputs.features[0];\n  const originalLayer = context.layer;\n  const layerId = originalLayer.getId();\n  const originalStyle = editingLayer.getStyle();\n  const style = new ol.style.Style({\n    fill: new ol.style.Fill({\n      color: 'rgba(255, 255, 255, 0.2)'\n    }),\n    stroke: new ol.style.Stroke({\n      color: '#ffcc33',\n      width: 3\n    }),\n    image: new ol.style.Circle({\n      radius: 7,\n      fill: new ol.style.Fill({\n        color: '#ffcc33'\n      })\n    })\n  });\n  const features = new ol.Collection(inputs.features);\n  let originalFeature = null;\n  feature.setStyle(style);\n  this._translateInteraction = new ol.interaction.Translate({\n    features: features,\n    hitTolerance: (isMobile && isMobile.any) ? 10 : 0\n  });\n  this.addInteraction(this._translateInteraction);\n\n  this._translateInteraction.on('translatestart',function(e){\n    const feature = e.features.getArray()[0];\n    // repndo la feature di partenza\n    originalFeature = feature.clone();\n  });\n  \n  this._translateInteraction.on('translateend',function(e) {\n    const feature = e.features.getArray()[0];\n    const newFeature = feature.clone();\n    session.pushUpdate(layerId, newFeature, originalFeature);\n    // ritorno come output l'input layer che sar modificato\n    inputs.features.push(newFeature);\n    feature.setStyle(originalStyle);\n    d.resolve(inputs);\n  });\n  return d.promise()\n};\n\n\nproto.stop = function() {\n  const d = $.Deferred();\n  this.removeInteraction(this._translateInteraction);\n  this._translateInteraction = null;\n  d.resolve();\n  return d.promise();\n};\n\n\n\nmodule.exports = MoveFeatureTask;\n","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst t = g3wsdk.core.i18n.t;\nconst GUI = g3wsdk.gui.GUI;\nconst WorkflowsStack = g3wsdk.core.workflow.WorkflowsStack;\nconst EditingTask = require('./editingtask');\nconst EditingFormComponent = require('../../../form/editingform');\n\nfunction OpenFormTask(options) {\n\n  options = options || {};\n  // prefisso delle nuove  feature\n  this._formIdPrefix = 'form_';\n  this._isContentChild = false;\n  this._feature;\n  this._originalLayer;\n  this._editingLayer;\n  this._layerName;\n  this._originalFeature;\n  this._pk;\n  this._fields;\n  this._session;\n  base(this, options);\n\n}\n\ninherit(OpenFormTask, EditingTask);\n\nmodule.exports = OpenFormTask;\n\nconst proto = OpenFormTask.prototype;\n\n\nproto._getFieldUniqueValuesFromServer = function(layer, uniqueFields) {\n  const fieldsName = _.map(uniqueFields, function(field) {\n    return field.name\n  });\n  layer.getWidgetData({\n    type: 'unique',\n    fields: fieldsName.join()\n  }).then(function(response) {\n    const data = response.data;\n    _.forEach(data, function(values, fieldName) {\n      _.forEach(values, function(value) {\n        uniqueFields[fieldName].input.options.values.push(value);\n      })\n    })\n  }).fail(function(){\n    console.log('errore')\n  })\n};\n\nproto._getUniqueFieldsType = function(fields) {\n  const uniqueFields = {};\n  _.forEach(fields, function(field) {\n     if (field.input.type == 'unique')\n       uniqueFields[field.name] = field;\n  });\n  return uniqueFields;\n};\n\nproto._getForm = function(inputs, context) {\n  const excludeFields = context.excludeFields;\n  this._isContentChild = !!(WorkflowsStack.getLength() > 1);\n  this._session = context.session;\n  // vado a recuperare i\n  this._originalLayer = context.layer;\n  this._editingLayer = inputs.layer;\n  this._pk = this._originalLayer.getPk();\n  this._layerName = this._originalLayer.getName();\n\n  // vado a prendere l'ultima feature\n  this._feature = inputs.features[inputs.features.length - 1];\n  this._originalFeature = this._feature.clone();\n  this._fields = this._originalLayer.getFieldsWithValues(this._feature, {\n    exclude: excludeFields\n  });\n  const uniqueFields = this._getUniqueFieldsType(this._fields);\n  if (!_.isEmpty(uniqueFields))\n    this._getFieldUniqueValuesFromServer(this._originalLayer, uniqueFields);\n  return GUI.showContentFactory('form');\n};\n\nproto._cancelFnc = function(promise, inputs) {\n  GUI.setModal(false);\n  promise.reject(inputs);\n};\n\nproto._saveFnc = function(promise, inputs) {\n  return function(fields) {\n    const newFeature = this._feature;\n    const layerId = this._originalLayer.getId();\n    // vado a settare per quel layer i valori ai campi\n    this._originalLayer.setFieldsWithValues(newFeature, fields);\n    // verifico se non  nuovo\n    if (!newFeature.isNew()) {\n      this._session.pushUpdate(layerId, newFeature, this._originalFeature);\n    } else {\n      //vado ad aggiungere la feature\n      if (this._originalLayer.isPkEditable())\n        _.forEach(fields, function (field) {\n          if (field.name == newFeature.getPk())\n            newFeature.set(newFeature.getPk(), field.value);\n        });\n    }\n    GUI.setModal(false);\n    promise.resolve(inputs);\n  }\n};\n\nproto.startForm = function(options) {\n  options = options || {};\n  const inputs = options.inputs;\n  const context = options.context;\n  const promise = options.promise;\n  const formComponent = options.formComponent || EditingFormComponent;\n  const Form = this._getForm(inputs, context);\n  const formService = Form({\n    formComponent: formComponent,\n    title: t(\"editing_attributes\") + \" \" + this._layerName,\n    name: t(\"editing_attributes\") + \" \" + this._layerName,\n    id: this._generateFormId(this._layerName),\n    dataid: this._layerName,\n    layer: this._originalLayer,\n    pk: this._pk,\n    isnew: this._originalFeature.isNew(),\n    fields: this._fields,\n    relationsOptions:  {\n      context: context,\n      inputs: inputs\n    },\n    modal: true,\n    push: this._isContentChild, // indica se posso aggiungere form\n    showgoback: !this._isContentChild, // se  figlo evito di visualizzare il go back\n    buttons:[{\n      title: t(\"save\"),\n      type: \"save\",\n      class: \"btn-success\",\n      cbk: _.bind(this._saveFnc(promise, inputs), this)\n    }, {\n      title: t(\"cancel\"),\n      type: \"cancel\",\n      class: \"btn-primary\",\n      cbk: _.bind(this._cancelFnc, this, promise, inputs)\n    }]\n  });\n  context.formService = formService;\n};\n\n// metodo eseguito all'avvio del tool\nproto.run = function(inputs, context) {\n  const d = $.Deferred();\n  this.startForm({\n    inputs: inputs,\n    context: context,\n    promise: d\n  });\n  return d.promise();\n};\n\n\nproto._generateFormId = function(layerName) {\n  return this._formIdPrefix + layerName;\n};\n\n// metodo eseguito alla disattivazione del tool\nproto.stop = function() {\n  this._isContentChild ? GUI.popContent() : GUI.closeForm();\n};\n\n","const inherit = g3wsdk.core.utils.inherit;\nconst base =  g3wsdk.core.utils.base;\nconst GUI = g3wsdk.gui.GUI;\nconst TableComponent = require('../../../table/vue/table');\nconst EditingTask = require('./editingtask');\nconst WorkflowsStack = g3wsdk.core.workflow.WorkflowsStack;\n\nfunction OpenTableTask(options) {\n\n  options = options || {};\n  // prefisso delle nuove  feature\n  this._formIdPrefix = 'form_';\n  this._isContentChild = false;\n  base(this, options);\n}\n\ninherit(OpenTableTask, EditingTask);\n\nconst proto = OpenTableTask.prototype;\n\n// metodo eseguito all'avvio del tool\nproto.run = function(inputs, context) {\n  console.log('Open Table Task task run.......');\n  const d = $.Deferred();\n  const originalLayer = context.layer;\n  const layerName = originalLayer.getName();\n  const headers = originalLayer.getEditingFields();\n  this._isContentChild = !!(WorkflowsStack.getLength() > 1);\n  const foreignKey = this._isContentChild ? context.excludeFields[0] :  null;\n  // vado a recuperare i\n  const editingLayer = inputs.layer;\n  const features = editingLayer.getSource().readFeatures();\n  const action = this._isContentChild ? 'Link ' :  'Edita ';\n  const content = new TableComponent({\n    title:  action + layerName,\n    features,\n    promise: d,\n    isrelation: this._isContentChild,\n    headers,\n    context,\n    inputs,\n    fatherValue: context.fatherValue,\n    foreignKey\n  });\n  GUI.showContent({\n    content,\n    push: this._isContentChild,\n    showgoback: !features.length, // if no features show back button\n    closable: false\n  });\n  return d.promise();\n};\n\nproto._generateFormId = function(layerName) {\n  return this._formIdPrefix + layerName;\n};\n\n\n// metodo eseguito alla disattivazione del tool\nproto.stop = function() {\n  console.log('stop open table task ...');\n  this._isContentChild ? GUI.popContent() : GUI.closeForm();\n  return true;\n};\n\nmodule.exports = OpenTableTask;\n\n","var inherit = g3wsdk.core.utils.inherit;\nvar base =  g3wsdk.core.utils.base;\nvar PickFeatureInteraction = g3wsdk.ol3.interactions.PickFeatureInteraction;\nvar EditingTask = require('./editingtask');\n\nfunction PickFeatureTask(options) {\n  this.pickFeatureInteraction = null;\n  this._busy = false;\n  this._tools = options.tools || [];\n  base(this, options);\n}\n\ninherit(PickFeatureTask, EditingTask);\n\nvar proto = PickFeatureTask.prototype;\n\n// metodo eseguito all'avvio del tool\nproto.run = function(inputs, context) {\n  console.log('Pick Feature Task run ....');\n  var d = $.Deferred();\n  //var style = this.editor._editingVectorStyle ? this.editor._editingVectorStyle.edit : null;\n  // vado a settare i layers su cui faccio l'interacion agisce\n  var layers = [inputs.layer];\n  var features = inputs.features.length ? inputs.features : null;\n  this.pickFeatureInteraction = new PickFeatureInteraction({\n    layers: layers,\n    features: features\n  });\n  // aggiungo\n  this.addInteraction(this.pickFeatureInteraction);\n  // gestisco l'evento\n  this.pickFeatureInteraction.on('picked', function(e) {\n    var feature = e.feature;\n    if (!features)\n      inputs.features.push(feature);\n    d.resolve(inputs);\n  });\n  return d.promise()\n};\n\n// metodo eseguito alla disattivazione del tool\nproto.stop = function() {\n  console.log('Stop pick feature');\n  this.removeInteraction(this.pickFeatureInteraction);\n  this.pickFeatureInteraction = null;\n  return true;\n};\n\n\nmodule.exports = PickFeatureTask;\n"],"sourceRoot":""}